(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{9319:function(e,t,s){Promise.resolve().then(s.bind(s,2041))},2041:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return B}});var i=s(7437),n=s(2265),r=s(9376),l=s(9013),a=s(1989);let o={[a.W.RUSH_50]:"⚔",[a.W.ADVANCE_SAFE_20]:"\uD83E\uDDED",[a.W.ATTACK]:"\uD83C\uDFAF",[a.W.FORMATION]:"\uD83C\uDFF0",[a.W.COVER]:"\uD83D\uDEE1",[a.W.EVADE]:"\uD83C\uDFC3",[a.W.DEFEND_KING]:"\uD83D\uDC51"};function c(){let e=(0,l.gT)(e=>e.computedActions),t=(0,l.gT)(e=>e.botThinking),s=(0,l.gT)(e=>e.game),n=(0,l.gT)(e=>e.winner),r=(0,l.gT)(e=>e.executeBotAction),a=(0,l.gT)(e=>e.setHoveredAction);if(!e||!s)return null;let c=t||!!n;return(0,i.jsxs)("div",{className:"flex flex-col gap-2 p-3 bg-gray-900/90 rounded-lg min-w-[180px]",children:[(0,i.jsx)("div",{className:"text-xs text-gray-400 font-semibold uppercase tracking-wide mb-1",children:"Bot Actions"}),e.map(e=>(0,i.jsxs)("button",{onClick:()=>r(e),onMouseEnter:()=>e.moves.length>0&&a(e),onMouseLeave:()=>a(null),disabled:c||0===e.moves.length,className:"flex items-center gap-2 px-3 py-2 rounded text-sm font-medium transition-colors text-left\n            ".concat(0===e.moves.length?"bg-gray-800 text-gray-600 cursor-not-allowed":c?"bg-gray-800 text-gray-500 cursor-not-allowed":"bg-gray-700 text-gray-200 hover:bg-blue-700 hover:text-white"),children:[(0,i.jsx)("span",{className:"text-base",children:o[e.type]}),(0,i.jsx)("span",{className:"flex-1",children:e.label}),(0,i.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded ".concat(e.moves.length>0?"bg-gray-600 text-gray-300":"bg-gray-800 text-gray-600"),children:e.pieceCount})]},e.type)),t&&(0,i.jsx)("div",{className:"text-yellow-400 text-xs animate-pulse mt-1",children:"Bot is choosing..."})]})}class h{resize(){let e=this.canvas.parentElement;if(e){let t=window.devicePixelRatio||1,s=e.getBoundingClientRect();this.canvas.width=s.width*t,this.canvas.height=s.height*t,this.canvas.style.width="".concat(s.width,"px"),this.canvas.style.height="".concat(s.height,"px"),this.ctx.scale(t,t)}}get displayWidth(){return this.canvas.width/(window.devicePixelRatio||1)}get displayHeight(){return this.canvas.height/(window.devicePixelRatio||1)}onRender(e){this.renderCallbacks.push(e)}start(){this.lastTime=performance.now();let e=t=>{let s=Math.min((t-this.lastTime)/1e3,.05);for(let e of(this.lastTime=t,this.ctx.save(),this.ctx.setTransform(window.devicePixelRatio||1,0,0,window.devicePixelRatio||1,0,0),this.ctx.clearRect(0,0,this.displayWidth,this.displayHeight),this.renderCallbacks))e(s);this.ctx.restore(),this.animationId=requestAnimationFrame(e)};this.animationId=requestAnimationFrame(e)}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=0)}destroy(){this.stop(),this.renderCallbacks=[]}constructor(e){this.animationId=0,this.renderCallbacks=[],this.lastTime=0,this.canvas=e,this.ctx=e.getContext("2d"),this.resize()}}let d="#f0d9b5",u="#b58863";class m{draw(e,t,s,i,n,r,l,a){let o=t*i,c=s*i;if(o>4096||c>4096){let o=null!=l?l:e.canvas.width,c=null!=a?a:e.canvas.height,h=Math.max(0,Math.floor(-n/i)),m=Math.min(t,Math.ceil((o-n)/i)),f=Math.max(0,Math.floor(-r/i)),g=Math.min(s,Math.ceil((c-r)/i));for(let t=f;t<g;t++)for(let s=h;s<m;s++)e.fillStyle=(s+t)%2==0?d:u,e.fillRect(n+s*i,r+t*i,i,i);return}let h="".concat(t,"_").concat(s,"_").concat(i);if(!this.boardCanvas||this.cacheKey!==h){this.boardCanvas=document.createElement("canvas"),this.boardCanvas.width=Math.ceil(o),this.boardCanvas.height=Math.ceil(c);let e=this.boardCanvas.getContext("2d");for(let n=0;n<s;n++)for(let s=0;s<t;s++)e.fillStyle=(s+n)%2==0?d:u,e.fillRect(s*i,n*i,i,i);this.cacheKey=h}e.drawImage(this.boardCanvas,n,r)}constructor(){this.boardCanvas=null,this.cacheKey=""}}var f=s(3418),g=s(6880);let x=new Map;function p(e,t,s){if(0!==t.length){for(let s of(e.beginPath(),e.moveTo(t[0].p0x,t[0].p0y),t))e.quadraticCurveTo(s.p1x,s.p1y,s.p2x,s.p2y);e.closePath(),e.fillStyle=s,e.fill()}}class v{clearCache(){x.clear()}draw(e,t,s,i,n,r,l,a,o){let c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,d=Math.floor(i);if(d<2)return;let u="".concat(n,"_").concat(r,"_").concat(l,"_").concat(d,"_").concat(a?1:0),m=x.get(u);if(m&&m.size===d||(m=this.renderFull(d,n,r,l,a),x.set(u,m)),e.save(),e.globalAlpha=c,1!==h){let n=t+i/2,r=s+i/2;e.translate(n,r),e.scale(h,h),e.translate(-n,-r)}let{pad:f}=m,g=i+2*f;e.drawImage(m.canvas,t-f,s-f,g,g),e.restore()}renderFull(e,t,s,i,n){let r=this.renderShapes(e,t,s),l=Math.ceil(.6*e),a=e+2*l,o=document.createElement("canvas");o.width=a,o.height=a;let c=o.getContext("2d"),h=i===f.GG.P1?"rgba(0, 200, 50, 0.85)":"rgba(220, 40, 40, 0.85)";return c.shadowColor=h,c.shadowBlur=n?.7*e:.5*e,c.shadowOffsetX=0,c.shadowOffsetY=0,c.drawImage(r,l,l,e,e),c.drawImage(r,l,l,e,e),c.shadowColor="transparent",c.shadowBlur=0,c.drawImage(r,l,l,e,e),n&&(c.fillStyle="#fbbf24",c.font="bold ".concat(Math.floor(.24*e),"px serif"),c.textAlign="left",c.textBaseline="top",c.fillText("♚",l+.02*e,l+.02*e)),{canvas:o,size:e,pad:l}}renderShapes(e,t,s){let i=document.createElement("canvas");i.width=e,i.height=e;let n=i.getContext("2d"),r=new g.R(t),l=s<4?2:3,a=s<4?2:3,o=.05*e,c=e-2*o;n.save(),n.translate(o,o);let h=[];for(let e=0;e<l;e++){let e=function(e,t){var s,i,n;let r=t/5,l=200*e.next(),a=200*e.next(),o=200*e.next(),c=(l+a+o)/3;return l=((s=l)+(c-s)*(1-r))*(1-.3*r),a=((i=a)+(c-i)*(1-r))*(1-.3*r),o=((n=o)+(c-n)*(1-r))*(1-.3*r),"rgb(".concat(Math.floor(l),",").concat(Math.floor(a),",").concat(Math.floor(o),")")}(r,s),t=[],i=[];for(let e=0;e<a;e++){let e=r.next()*c,s=r.next()*c,n=r.next()*c,l=r.next()*c,a=r.next()*c,o=r.next()*c;t.push({p0x:e,p0y:s,p1x:n,p1y:l,p2x:a,p2y:o}),i.push({p0x:c-e,p0y:s,p1x:c-n,p1y:l,p2x:c-a,p2y:o})}h.push({segments:t,mirroredSegments:i,color:e})}for(let e of(n.save(),n.translate(c/2,c/2),n.scale(1.04,1.05),n.translate(-c/2,-c/2),h))p(n,e.segments,"rgba(100,100,100,0.5)"),p(n,e.mirroredSegments,"rgba(100,100,100,0.5)");for(let e of(n.restore(),h))p(n,e.segments,e.color),p(n,e.mirroredSegments,e.color);return n.restore(),i}}let y={F:{hex:"#22c55e",label:"Move",description:"Move to free position"},E:{hex:"#ef4444",label:"Capture",description:"Capture enemy piece"},X:{hex:"#f97316",label:"Jump",description:"Jump to position (move or capture)"},M:{hex:"#3b82f6",label:"Move",description:"Move along clear path (move or capture)"},S:{hex:"#a855f7",label:"Swap",description:"Swap with friendly piece"},R:{hex:"#06b6d4",label:"Rush",description:"Rush in direction"},C:{hex:"#ec4899",label:"Cross",description:"Cross attack on free position"},Y:{hex:"#f59e0b",label:"Explode",description:"Explosion attack on free position"},Z:{hex:"#84cc16",label:"Zombie",description:"Zombie attack on enemy"},A:{hex:"#8b5cf6",label:"Range",description:"Ranged attack (clear path)"},Q:{hex:"#14b8a6",label:"Convert",description:"Convert enemy piece"},L:{hex:"#e11d48",label:"Legion",description:"Legion attack"}};function b(e){var t;return null!==(t=y[e])&&void 0!==t?t:{hex:"#6b7280",label:e,description:e}}let w=[0,200,0],M=[220,30,30];class C{drawSelected(e,t,s,i,n){e.fillStyle="rgba(255, 255, 0, 0.4)",e.fillRect(i+t.x*s,n+t.y*s,s,s)}drawPossibleMoves(e,t,s,i,n,r){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.25,[a,o,c]=r?w:M,h=Math.min(2.2*l,.7),d=Math.max(2,.08*s),u=.14*s;for(let r of t){let t=i+r.x*s,m=n+r.y*s;e.fillStyle="#d0ae8b",e.fillRect(t,m,s,s),e.fillStyle="rgba(".concat(a,", ").concat(o,", ").concat(c,", ").concat(l,")"),e.fillRect(t,m,s,s),e.strokeStyle="rgba(".concat(a,", ").concat(o,", ").concat(c,", ").concat(h,")"),e.lineWidth=d,e.strokeRect(t+d/2,m+d/2,s-d,s-d);let[f,g,x]=function(e){let t=parseInt(e.slice(1),16);return[t>>16&255,t>>8&255,255&t]}(b(r.tag).hex),p=t+s/2,v=m+s/2,y=Math.min(l+.45,.9);e.beginPath(),e.arc(p,v,u,0,2*Math.PI),e.fillStyle="rgba(".concat(f,", ").concat(g,", ").concat(x,", ").concat(y,")"),e.fill(),e.strokeStyle="rgba(0, 0, 0, 0.5)",e.lineWidth=1,e.stroke()}}}var T=s(406);class P{setGrid(e,t,s){this.offsetX=e,this.offsetY=t,this.cellSize=s}setClickHandler(e){this.onClick=e}setDoubleClickHandler(e){this.onDoubleClick=e}setHoverHandler(e){this.onHover=e}pixelToGrid(e,t){let s=Math.floor((e-this.offsetX)/this.cellSize),i=Math.floor((t-this.offsetY)/this.cellSize);return s<0||i<0?null:new T.Y(s,i)}handleClick(e){let t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,n=this.pixelToGrid(s,i);n&&this.onClick&&this.onClick(n)}handleDoubleClick(e){let t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,n=this.pixelToGrid(s,i);n&&this.onDoubleClick&&this.onDoubleClick(n)}handleTouch(e){if(e.preventDefault(),e.touches.length>0){let t=this.canvas.getBoundingClientRect(),s=e.touches[0].clientX-t.left,i=e.touches[0].clientY-t.top,n=this.pixelToGrid(s,i);n&&this.onClick&&this.onClick(n)}}handleMouseMove(e){let t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,n=this.pixelToGrid(s,i);this.onHover&&this.onHover(n)}handleMouseLeave(){this.onHover&&this.onHover(null)}handleContextMenu(e){e.preventDefault()}destroy(){this.canvas.removeEventListener("click",this.handleClick),this.canvas.removeEventListener("dblclick",this.handleDoubleClick),this.canvas.removeEventListener("touchstart",this.handleTouch),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("contextmenu",this.handleContextMenu)}constructor(e){this.offsetX=0,this.offsetY=0,this.cellSize=1,this.onClick=null,this.onDoubleClick=null,this.onHover=null,this.canvas=e,this.handleClick=this.handleClick.bind(this),this.handleDoubleClick=this.handleDoubleClick.bind(this),this.handleTouch=this.handleTouch.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleContextMenu=this.handleContextMenu.bind(this),e.addEventListener("click",this.handleClick),e.addEventListener("dblclick",this.handleDoubleClick),e.addEventListener("touchstart",this.handleTouch,{passive:!1}),e.addEventListener("mousemove",this.handleMouseMove),e.addEventListener("mouseleave",this.handleMouseLeave),e.addEventListener("contextmenu",this.handleContextMenu)}}var j=s(3375);class k{animate(e){var t;this.progressTime+=e;let s=(t=Math.max(0,Math.min(1,t=Math.min(this.progressTime/this.duration,1))))*t*(3-2*t);this.currentX=this.fromX+(this.toX-this.fromX)*s,this.currentY=this.fromY+(this.toY-this.fromY)*s}isFinished(){return this.progressTime>=this.duration}constructor(e,t,s,i,n,r){this.progressTime=0,this.piece=e,this.fromX=n+t.x*i,this.fromY=r+t.y*i,this.toX=n+s.x*i,this.toY=r+s.y*i,this.currentX=this.fromX,this.currentY=this.fromY;let l=this.toX-this.fromX,a=this.toY-this.fromY;this.duration=.15+.003*Math.sqrt(l*l+a*a)}}class S{animate(e){this.progressTime+=e;let t=Math.min(this.progressTime/this.duration,1);this.scale=1-t,this.alpha=1-t}isFinished(){return this.progressTime>=this.duration}constructor(e,t,s,i,n){this.duration=.25,this.progressTime=0,this.scale=1,this.alpha=1,this.piece=e,this.x=i+t.x*s,this.y=n+t.y*s}}class Y{animate(e){var t;this.progressTime+=e;let s=(t=Math.max(0,Math.min(1,t=Math.min(this.progressTime/this.duration,1))))*t*(3-2*t);this.current1X=this.from1X+(this.to1X-this.from1X)*s,this.current1Y=this.from1Y+(this.to1Y-this.from1Y)*s,this.current2X=this.from2X+(this.to2X-this.from2X)*s,this.current2Y=this.from2Y+(this.to2Y-this.from2Y)*s}isFinished(){return this.progressTime>=this.duration}constructor(e,t,s,i,n,r,l){this.progressTime=0,this.piece1=e,this.piece2=t,this.from1X=r+s.x*n,this.from1Y=l+s.y*n,this.to1X=r+i.x*n,this.to1Y=l+i.y*n,this.from2X=this.to1X,this.from2Y=this.to1Y,this.to2X=this.from1X,this.to2Y=this.from1Y,this.current1X=this.from1X,this.current1Y=this.from1Y,this.current2X=this.from2X,this.current2Y=this.from2Y;let a=this.to1X-this.from1X,o=this.to1Y-this.from1Y;this.duration=.3+.002*Math.sqrt(a*a+o*o)}}class N{animate(e){var t;this.progressTime+=e;let s=(t=Math.max(0,Math.min(1,t=Math.min(this.progressTime/this.duration,1))))*t*(3-2*t);if(this.currentX=this.fromX+(this.toX-this.fromX)*s,this.currentY=this.fromY+(this.toY-this.fromY)*s,!this.shatterStarted&&s>.9&&(this.shatterStarted=!0),this.shatterStarted){let e=Math.min((s-.9)/.09999999999999998,1);this.targetScale=1-e,this.targetAlpha=1-e}}isFinished(){return this.progressTime>=this.duration}constructor(e,t,s,i,n,r,l){this.progressTime=0,this.targetScale=1,this.targetAlpha=1,this.shatterStarted=!1,this.particlesSpawned=!1,this.piece=e,this.targetPiece=i,this.fromX=r+t.x*n,this.fromY=l+t.y*n,this.toX=r+s.x*n,this.toY=l+s.y*n,this.currentX=this.fromX,this.currentY=this.fromY,this.targetX=this.toX,this.targetY=this.toY;let a=this.toX-this.fromX,o=this.toY-this.fromY;this.duration=.15+.003*Math.sqrt(a*a+o*o)}}function A(e){return{id:e.id,seed:e.pieceType.pieceTypeId.seed,lvl:e.lvl,owner:e.owner,king:e.king,symbol:e.symbol}}class X{get isAnimating(){return this._isAnimating}startFromDrawEvent(e,t,s,i,n,r){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];for(let a of(this.queue=[],this.currentIndex=0,this.onComplete=r,this.parallel=l,e.getEvents()))switch(a.type){case j.t.MOVE:{let e=A(a.piece);this.queue.push(new k(e,a.fromPos,a.toPos,s,i,n));break}case j.t.DESTROY:{let e=A(a.piece);this.queue.push(new S(e,a.pos,s,i,n));break}case j.t.SWAP:{let e=t.pieceAt(a.toPos),r=t.pieceAt(a.fromPos);e&&r&&this.queue.push(new Y(A(e),A(r),a.fromPos,a.toPos,s,i,n));break}case j.t.MOVE_AND_DESTROY:this.queue.push(new N(A(a.piece),a.fromPos,a.toPos,A(a.targetPiece),s,i,n))}this._isAnimating=this.queue.length>0}update(e){var t,s,i;if(this._isAnimating){if(this.parallel){let s=!0;for(let t of this.queue)t.isFinished()||(t.animate(e),t.isFinished()||(s=!1));s&&(this._isAnimating=!1,null===(t=this.onComplete)||void 0===t||t.call(this))}else{if(this.currentIndex>=this.queue.length){this._isAnimating=!1,null===(s=this.onComplete)||void 0===s||s.call(this);return}let t=this.queue[this.currentIndex];t.animate(e),t.isFinished()&&(this.currentIndex++,this.currentIndex>=this.queue.length&&(this._isAnimating=!1,null===(i=this.onComplete)||void 0===i||i.call(this)))}}}getActiveAnimations(){return this._isAnimating?this.parallel?this.queue.filter(e=>!e.isFinished()):this.currentIndex>=this.queue.length?[]:[this.queue[this.currentIndex]]:[]}cancel(){this._isAnimating=!1,this.queue=[],this.currentIndex=0,this.onComplete=null}constructor(){this.queue=[],this.currentIndex=0,this._isAnimating=!1,this.onComplete=null,this.parallel=!1}}var R=s(7406),E=s.n(R);class D{spawn(e,t,s,i,n){let r=n/50,l=.05*n,a=n-2*l,o=new g.R(s),c=i<4?2:3,h=i<4?2:3,d=e-n/2,u=t-n/2;for(let s=0;s<c;s++){let s=function(e,t){var s,i,n;let r=t/5,l=200*e.next(),a=200*e.next(),o=200*e.next(),c=(l+a+o)/3;return{r:Math.floor(l=((s=l)+(c-s)*(1-r))*(1-.3*r)),g:Math.floor(a=((i=a)+(c-i)*(1-r))*(1-.3*r)),b:Math.floor(o=((n=o)+(c-n)*(1-r))*(1-.3*r))}}(o,i),n="rgb(".concat(s.r,",").concat(s.g,",").concat(s.b,")"),c=[],m=[];for(let e=0;e<h;e++){let e=o.next()*a,t=o.next()*a,s=o.next()*a,i=o.next()*a,n=o.next()*a,r=o.next()*a;c.push({p0x:e,p0y:t,p1x:s,p1y:i,p2x:n,p2y:r}),m.push({p0x:a-e,p0y:t,p1x:a-s,p1y:i,p2x:a-n,p2y:r})}this.addShapeFragment(c,n,l,d,u,e,t,r),this.addShapeFragment(m,n,l,d,u,e,t,r)}}addShapeFragment(e,t,s,i,n,r,l,a){if(0===e.length)return;let o=1/0,c=1/0,h=-1/0,d=-1/0;for(let t of e)o=Math.min(o,t.p0x,t.p1x,t.p2x),c=Math.min(c,t.p0y,t.p1y,t.p2y),h=Math.max(h,t.p0x,t.p1x,t.p2x),d=Math.max(d,t.p0y,t.p1y,t.p2y);let u=Math.ceil((h+=1)-(o-=1)),m=Math.ceil((d+=1)-(c-=1));if(u<1||m<1)return;let f=document.createElement("canvas");f.width=u,f.height=m;let g=f.getContext("2d");for(let t of(g.translate(-o,-c),g.beginPath(),g.moveTo(e[0].p0x,e[0].p0y),e))g.quadraticCurveTo(t.p1x,t.p1y,t.p2x,t.p2y);g.closePath(),g.fillStyle=t,g.fill();let x=i+s+(o+h)/2,p=n+s+(c+d)/2,v=u/2,y=m/2;for(let e=0;e<2;e++){let e=3*a,t=x+(Math.random()-.5)*e,s=p+(Math.random()-.5)*e,i=E().Bodies.rectangle(t,s,u,m,{frictionAir:.008,restitution:.3,collisionFilter:{group:-1}}),n=t-r,o=s-l,c=Math.sqrt(n*n+o*o)||1,h=(3+6*Math.random())*a;E().Body.setVelocity(i,{x:n/c*h+(Math.random()-.5)*3*a,y:o/c*h-2*a}),E().Body.setAngularVelocity(i,(Math.random()-.5)*.4),E().Composite.add(this.engine.world,i),this.fragments.push({body:i,canvas:f,hw:v,hh:y,lifetime:2.5+2.5*Math.random()})}}update(e){if(0!==this.fragments.length){for(this.accumulator+=1e3*e,this.accumulator>100&&(this.accumulator=100);this.accumulator>=16.667;)E().Engine.update(this.engine,16.667),this.accumulator-=16.667;for(let t=this.fragments.length-1;t>=0;t--)this.fragments[t].lifetime-=e,this.fragments[t].lifetime<=0&&(E().Composite.remove(this.engine.world,this.fragments[t].body),this.fragments.splice(t,1))}}draw(e){if(0===this.fragments.length)return;e.save();let t=window.devicePixelRatio||1;for(let s of this.fragments){let{body:i,canvas:n,hw:r,hh:l,lifetime:a}=s,o=a<1.5?a/1.5:1;if(o<.01)continue;e.globalAlpha=o;let c=Math.cos(i.angle),h=Math.sin(i.angle);e.setTransform(c*t,h*t,-h*t,c*t,i.position.x*t,i.position.y*t),e.drawImage(n,-r,-l)}e.restore()}hasActiveParticles(){return this.fragments.length>0}constructor(){this.fragments=[],this.accumulator=0,this.engine=E().Engine.create({gravity:{x:0,y:.3,scale:.001}})}}function G(){let e=(0,n.useRef)(null),t=(0,n.useRef)(null),s=(0,n.useRef)(null),r=(0,n.useRef)(null),o=(0,n.useRef)(new X),d=(0,n.useRef)(new m),u=(0,n.useRef)(new v),g=(0,n.useRef)(new C),x=(0,n.useRef)(null),p=(0,n.useRef)(new D),y=(0,n.useRef)(0),b=(0,n.useRef)(1),w=(0,n.useRef)(0),M=(0,n.useRef)(0),T=(0,n.useRef)(!1),A=(0,n.useRef)({x:0,y:0}),R=(0,n.useRef)({x:0,y:0}),E=(0,n.useRef)(null),G=(0,n.useRef)(null),F=(0,n.useRef)(-1),L=(0,l.gT)(e=>e.game),I=(0,l.gT)(e=>e.config.botActions);(0,n.useEffect)(()=>{let t=e.current;if(!t)return;let i=new h(t);s.current=i;let n=new P(t);r.current=n,n.setClickHandler(e=>{if(T.current)return;let t=l.gT.getState();if(!t.game||o.current.isAnimating)return;let s=t.game.state.width,i=t.game.state.height;e.x<0||e.y<0||e.x>=s||e.y>=i||t.clickCell(e)}),n.setHoverHandler(e=>{x.current=e}),i.onRender(e=>{H(i,e)}),i.start();let a=e=>{e.preventDefault();let s=l.gT.getState();if(!s.game)return;let{width:n,height:r}=s.game.state,a=i.displayWidth,o=i.displayHeight,c=Math.min(a/n,o/r),h=b.current,d=c*h,u=h*(e.deltaY<0?1.15:1/1.15);u=Math.max(Math.max(4/c,.1),Math.min(80/c,u));let m=c*u,f=t.getBoundingClientRect(),g=e.clientX-f.left,x=e.clientY-f.top,p=(a-d*n)/2+w.current,v=(o-d*r)/2+M.current;w.current=g-(g-p)/d*m-(a-m*n)/2,M.current=x-(x-v)/d*m-(o-m*r)/2,b.current=u};t.addEventListener("wheel",a,{passive:!1});let c=e=>{2===e.button&&(T.current=!0,A.current={x:e.clientX,y:e.clientY},R.current={x:w.current,y:M.current})},d=e=>{T.current&&(w.current=R.current.x+(e.clientX-A.current.x),M.current=R.current.y+(e.clientY-A.current.y))},u=e=>{2===e.button&&(T.current=!1)};t.addEventListener("mousedown",c),window.addEventListener("mousemove",d),window.addEventListener("mouseup",u);let m=()=>{i.resize()};return window.addEventListener("resize",m),()=>{t.removeEventListener("wheel",a),t.removeEventListener("mousedown",c),window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",u),window.removeEventListener("resize",m),n.destroy(),i.destroy()}},[]),(0,n.useEffect)(()=>{if(L){let e=1e4*L.state.width+L.state.height;null!==E.current&&E.current!==e&&(b.current=1,w.current=0,M.current=0),E.current=e}},[L]);let _=(0,n.useCallback)(()=>{b.current=1,w.current=0,M.current=0},[]),B=(0,n.useCallback)(()=>{let e=l.gT.getState();if(!e.game||!s.current)return;let{width:t,height:i}=e.game.state,n=s.current.displayWidth,r=s.current.displayHeight,a=Math.min(n/t,r/i),o=b.current,c=Math.min(1.3*o,80/a),h=a*o,d=a*c,u=n/2,m=r/2,f=(n-h*t)/2+w.current,g=(r-h*i)/2+M.current;w.current=u-(u-f)/h*d-(n-d*t)/2,M.current=m-(m-g)/h*d-(r-d*i)/2,b.current=c},[]),q=(0,n.useCallback)(()=>{let e=l.gT.getState();if(!e.game||!s.current)return;let{width:t,height:i}=e.game.state,n=s.current.displayWidth,r=s.current.displayHeight,a=Math.min(n/t,r/i),o=b.current,c=Math.max(o/1.3,Math.max(4/a,.1)),h=a*o,d=a*c,u=n/2,m=r/2,f=(n-h*t)/2+w.current,g=(r-h*i)/2+M.current;w.current=u-(u-f)/h*d-(n-d*t)/2,M.current=m-(m-g)/h*d-(r-d*i)/2,b.current=c},[]),H=(0,n.useCallback)((e,t)=>{var s;let i=l.gT.getState(),n=i.game;if(!n)return;let c=e.ctx,{width:h,height:m}=n.state,v=e.displayWidth,C=e.displayHeight,T=Math.min(v/h,C/m)*b.current,P=(v-T*h)/2+w.current,A=(C-T*m)/2+M.current;null===(s=r.current)||void 0===s||s.setGrid(P,A,T);let X=Math.max(0,Math.floor(-P/T)),R=Math.min(h,Math.ceil((v-P)/T)),E=Math.max(0,Math.floor(-A/T)),D=Math.min(m,Math.ceil((C-A)/T)),L=o.current,I=p.current;if(i.pendingDrawEvent&&!L.isAnimating){let e=i.pendingParallelDraw;for(let e of i.pendingDrawEvent.getEvents())if(e.type===j.t.DESTROY){let t=P+e.pos.x*T+T/2,s=A+e.pos.y*T+T/2;I.spawn(t,s,e.piece.pieceType.pieceTypeId.seed,e.piece.lvl,T)}L.startFromDrawEvent(i.pendingDrawEvent,n.state,T,P,A,()=>{let e=l.gT.getState(),t=e.game;!t||t.getWinner()||e.botThinking||(e.config.botActions?"bot"===e.config.mode&&t.getPlayersTurn()===f.GG.P2&&(0,l.Dm)():"bot"===e.config.mode&&t.getPlayersTurn()===f.GG.P2&&(0,l.Vx)())},e),l.gT.setState({pendingDrawEvent:null,pendingParallelDraw:!1})}d.current.draw(c,h,m,T,P,A,v,C);let _=n.getPlayersTurn(),B=i.hoveredAction;if(!B){let e=!L.isAnimating&&i.selectedPiece?.45:0,s=y.current;if(y.current=s+(e-s)*Math.min(1,8*t),y.current>.01){let e=new Set;if(i.selectedPiece)for(let t of(e.add(i.selectedPiece.pos.y*h+i.selectedPiece.pos.x),i.possibleMoves))e.add(t.y*h+t.x);c.fillStyle="rgba(50, 35, 15, ".concat(y.current,")");for(let t=E;t<D;t++)for(let s=X;s<R;s++)e.has(t*h+s)||c.fillRect(P+s*T,A+t*T,T,T)}}if(!L.isAnimating&&!B){if(i.selectedPiece){let e=.5+.5*Math.sin(performance.now()/1e3*Math.PI),t=i.selectedPiece.owner===_;g.current.drawSelected(c,i.selectedPiece.pos,T,P,A),g.current.drawPossibleMoves(c,i.possibleMoves,T,P,A,t,.15+.15*e)}let e=(()=>{let e=x.current;return!e||e.x<0||e.y<0||e.x>=h||e.y>=m?null:n.state.pieceAt(e)})();if(e&&e!==i.selectedPiece){let t=e.owner===_,s=[...e.moveSet.getPossibleMoves()];g.current.drawSelected(c,e.pos,T,P,A),g.current.drawPossibleMoves(c,s,T,P,A,t,.25)}}L.update(t);let q=new Set;for(let e of L.getActiveAnimations())e instanceof k?q.add(e.piece.id):e instanceof S?q.add(e.piece.id):e instanceof N?(q.add(e.piece.id),q.add(e.targetPiece.id)):e instanceof Y&&(q.add(e.piece1.id),q.add(e.piece2.id));for(let e of n.state.getAllPieces()){if(q.has(e.id))continue;let t=P+e.pos.x*T,s=A+e.pos.y*T;t+T<0||t>v||s+T<0||s>C||u.current.draw(c,t,s,T,e.pieceType.pieceTypeId.seed,e.lvl,e.owner,e.king,e.symbol)}for(let e of L.getActiveAnimations())if(e instanceof k)W(c,e.piece,e.currentX,e.currentY,T);else if(e instanceof S)W(c,e.piece,e.x,e.y,T,e.alpha,e.scale);else if(e instanceof N){if(W(c,e.piece,e.currentX,e.currentY,T),e.targetAlpha>.01&&W(c,e.targetPiece,e.targetX,e.targetY,T,e.targetAlpha,e.targetScale),e.shatterStarted&&!e.particlesSpawned){e.particlesSpawned=!0;let t=e.targetPiece;I.spawn(e.targetX+T/2,e.targetY+T/2,t.seed,t.lvl,T)}}else e instanceof Y&&(W(c,e.piece1,e.current1X,e.current1Y,T),W(c,e.piece2,e.current2X,e.current2Y,T));if(!B&&!L.isAnimating){let e=x.current,t=n.getTurns();F.current!==t&&(G.current=null,F.current=t);let s=e?"".concat(e.x,",").concat(e.y):"",i=G.current;if(e&&e.x>=0&&e.y>=0&&e.x<h&&e.y<m){let t=n.state.pieceAt(e);if(t){let r;if(i&&i.posKey===s)r=i;else{let i=[],l=[],a=[];for(let s of n.state.getAllPieces())s!==t&&s.moveSet.getPossibleMoves().some(t=>t.x===e.x&&t.y===e.y)&&(s.owner===t.owner?i.push({fx:s.pos.x,fy:s.pos.y,tx:e.x,ty:e.y}):l.push({fx:s.pos.x,fy:s.pos.y,tx:e.x,ty:e.y}));for(let s of t.moveSet.getPossibleMoves()){let i=n.state.pieceAt(s);i&&i.owner!==t.owner&&a.push({fx:e.x,fy:e.y,tx:s.x,ty:s.y})}r={posKey:s,defenders:i,attackers:l,targets:a},G.current=r}let l=Math.max(1.5,.045*T),a=.2*T,o=(e,t)=>{if(0!==e.length){for(let s of(c.strokeStyle=t,c.fillStyle=t,c.lineWidth=l,c.lineCap="round",c.beginPath(),e)){let e=P+(s.fx+.5)*T,t=A+(s.fy+.5)*T,i=P+(s.tx+.5)*T,n=A+(s.ty+.5)*T;c.moveTo(e,t),c.lineTo(i,n)}for(let t of(c.stroke(),e)){let e=P+(t.fx+.5)*T,s=A+(t.fy+.5)*T,i=P+(t.tx+.5)*T,n=A+(t.ty+.5)*T,r=Math.atan2(n-s,i-e);c.beginPath(),c.moveTo(i,n),c.lineTo(i-a*Math.cos(r-.4),n-a*Math.sin(r-.4)),c.lineTo(i-a*Math.cos(r+.4),n-a*Math.sin(r+.4)),c.closePath(),c.fill()}}},h=t.owner===f.GG.P1?"rgba(50, 220, 80, 0.50)":"rgba(220, 60, 60, 0.50)",d=t.owner===f.GG.P1?"rgba(220, 60, 60, 0.50)":"rgba(50, 220, 80, 0.50)";o(r.defenders,h),o(r.attackers,d),o(r.targets,h)}else G.current=null}else G.current=null}if(B&&B.moves.length>0&&!L.isAnimating){let e=new Set,t=new Set;for(let s of B.moves)e.add(s.fromY*h+s.fromX),t.add(s.toY*h+s.toX);let s=new Set;if(B.enemyCells)for(let e of B.enemyCells)s.add(e.y*h+e.x);let i=new Set;if(B.protectedCells)for(let e of B.protectedCells)i.add(e.y*h+e.x);c.fillStyle="rgba(50, 35, 15, 0.55)";for(let n=E;n<D;n++)for(let r=X;r<R;r++){let l=n*h+r;e.has(l)||t.has(l)||s.has(l)||i.has(l)||c.fillRect(P+r*T,A+n*T,T,T)}let n=B.type===a.W.ATTACK;for(let e of(c.fillStyle=n?"rgba(220, 50, 50, 0.30)":"rgba(50, 200, 50, 0.30)",B.moves))c.fillRect(P+e.toX*T,A+e.toY*T,T,T);if(B.enemyCells&&B.enemyCells.length>0)for(let e of(c.fillStyle="rgba(220, 50, 50, 0.30)",B.enemyCells))c.fillRect(P+e.x*T,A+e.y*T,T,T);if(B.protectedCells&&B.protectedCells.length>0)for(let e of(c.fillStyle="rgba(50, 200, 50, 0.30)",B.protectedCells))c.fillRect(P+e.x*T,A+e.y*T,T,T);let r=Math.max(1,.04*T),l=.18*T,o=_===f.GG.P1?"rgba(80, 220, 80, 0.55)":"rgba(220, 80, 80, 0.55)";for(let e of(c.strokeStyle=o,c.fillStyle=o,c.lineWidth=r,c.lineCap="round",c.beginPath(),B.moves)){let t=P+(e.fromX+.5)*T,s=A+(e.fromY+.5)*T,i=P+(e.toX+.5)*T,n=A+(e.toY+.5)*T;c.moveTo(t,s),c.lineTo(i,n)}for(let e of(c.stroke(),B.moves)){let t=P+(e.fromX+.5)*T,s=A+(e.fromY+.5)*T,i=P+(e.toX+.5)*T,n=A+(e.toY+.5)*T,r=Math.atan2(n-s,i-t);c.beginPath(),c.moveTo(i,n),c.lineTo(i-l*Math.cos(r-.4),n-l*Math.sin(r-.4)),c.lineTo(i-l*Math.cos(r+.4),n-l*Math.sin(r+.4)),c.closePath(),c.fill()}y.current=0}I.update(t),I.draw(c)},[]);function W(e,t,s,i,n){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;u.current.draw(e,s,i,n,t.seed,t.lvl,t.owner,t.king,t.symbol,r,l)}return(0,i.jsxs)("div",{ref:t,className:"relative w-full h-full",children:[(0,i.jsx)("canvas",{ref:e,className:"w-full h-full block",style:{touchAction:"none"}}),I&&(0,i.jsx)("div",{className:"absolute top-4 left-4",children:(0,i.jsx)(c,{})}),(0,i.jsxs)("div",{className:"absolute bottom-4 right-4 flex flex-col gap-1",children:[(0,i.jsx)("button",{onClick:B,className:"w-9 h-9 bg-gray-800/80 hover:bg-gray-700 text-white rounded flex items-center justify-center text-lg font-bold select-none",title:"Zoom in",children:"+"}),(0,i.jsx)("button",{onClick:q,className:"w-9 h-9 bg-gray-800/80 hover:bg-gray-700 text-white rounded flex items-center justify-center text-lg font-bold select-none",title:"Zoom out",children:"−"}),(0,i.jsx)("button",{onClick:_,className:"w-9 h-9 bg-gray-800/80 hover:bg-gray-700 text-white rounded flex items-center justify-center text-xs font-bold select-none",title:"Fit to view",children:"Fit"})]})]})}function F(){let e=(0,l.gT)(e=>e.game),t=(0,l.gT)(e=>e.winner),s=(0,l.gT)(e=>e.botThinking),n=(0,l.gT)(e=>e.config),r=(0,l.gT)(e=>e.undoMove);if(!e)return null;let a=e.getPlayersTurn(),o=a===f.GG.P1?"Blue (P1)":"Red (P2)";return(0,i.jsxs)("div",{className:"flex flex-col gap-3 p-4 bg-gray-900 text-white min-w-[200px]",children:[(0,i.jsx)("h2",{className:"text-lg font-bold",children:"FreeChazz"}),(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("span",{className:"text-gray-400",children:"Turn: "}),(0,i.jsx)("span",{className:a===f.GG.P1?"text-blue-400":"text-red-400",children:o})]}),(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("span",{className:"text-gray-400",children:"Move: "}),(0,i.jsx)("span",{children:e.getTurns()})]}),(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("span",{className:"text-gray-400",children:"Mode: "}),(0,i.jsx)("span",{children:"bot"===n.mode?"vs Bot (depth ".concat(n.botDepth,")"):"Hot Seat"})]}),(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("span",{className:"text-gray-400",children:"Board: "}),(0,i.jsxs)("span",{children:[e.state.width,"x",e.state.height]})]}),s&&(0,i.jsx)("div",{className:"text-yellow-400 text-sm animate-pulse",children:"Bot is thinking..."}),t&&(0,i.jsxs)("div",{className:"bg-yellow-600 text-black font-bold text-center py-2 px-3 rounded",children:[t===f.GG.P1?"Blue (P1)":"Red (P2)"," wins!"]}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 mt-2",children:[(0,i.jsx)("button",{onClick:r,disabled:0===e.getTurns()||s,className:"bg-gray-700 hover:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed px-3 py-1.5 rounded text-sm",children:"Undo"}),(0,i.jsx)("button",{onClick:()=>{l.gT.getState().cleanup(),window.location.href="/"},className:"bg-red-800 hover:bg-red-700 px-3 py-1.5 rounded text-sm",children:"Back to Menu"})]})]})}function L(){let e=(0,l.gT)(e=>e.selectedPiece);if(!e)return null;let t=e.pieceType,s=e.owner===f.GG.P1?"Blue (P1)":"Red (P2)",n=e.owner===f.GG.P1?"text-blue-400":"text-red-400",r=e.owner===f.GG.P1,a=t.actionMap,o=a.keySet(),c=0,h=0,d=0,u=0;for(let e of o)c=Math.min(c,e.x),h=Math.max(h,e.x),d=Math.min(d,e.y),u=Math.max(u,e.y);c=Math.min(c,-1),h=Math.max(h,1),d=Math.min(d,-1);let m=h-c+1,g=(u=Math.max(u,1))-d+1,x=new Set;for(let e of o){let t=a.getByXY(e.x,e.y);(null==t?void 0:t.symbol)&&x.add(t.symbol)}return(0,i.jsxs)("div",{className:"bg-gray-800 text-white p-3 rounded text-sm",children:[(0,i.jsxs)("div",{className:"font-bold mb-1",children:[e.king?"King ":"",(0,i.jsx)("span",{className:"text-lg",children:t.symbol})]}),(0,i.jsxs)("div",{className:"text-gray-400",children:["Owner: ",(0,i.jsx)("span",{className:n,children:s})]}),(0,i.jsxs)("div",{className:"text-gray-400 mb-2",children:["Level: ",t.pieceTypeId.lvl]}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Action Map:"}),(0,i.jsx)("div",{className:"inline-grid gap-0",style:{gridTemplateColumns:"repeat(".concat(m,", 18px)"),gridTemplateRows:"repeat(".concat(g,", 18px)")},children:Array.from({length:g},(e,s)=>Array.from({length:m},(e,n)=>{let l;let o=n+c,h=r?u-s:s+d,m=0===o&&0===h,f=a.getByXY(o,h),g="",x="";if(m)l="#ca8a04",g=t.symbol,x="Piece position";else if(f){let e=b(f.symbol);l=e.hex,g=f.symbol,x="".concat(f.symbol,": ").concat(e.description)}return(0,i.jsx)("div",{className:"border border-gray-600 flex items-center justify-center text-[10px] font-mono",style:{backgroundColor:null!=l?l:"#374151"},title:x,children:g},"".concat(o,",").concat(h))}))}),x.size>0&&(0,i.jsx)("div",{className:"mt-2 flex flex-wrap gap-x-3 gap-y-1",children:Array.from(x).map(e=>{let t=b(e);return(0,i.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-gray-300",title:t.description,children:[(0,i.jsx)("span",{className:"inline-block w-2.5 h-2.5 rounded-sm",style:{backgroundColor:t.hex}}),(0,i.jsx)("span",{className:"font-mono font-bold",children:e}),(0,i.jsx)("span",{children:t.label})]},e)})})]})}function I(e){let{p1:t,p2:s}=e,n=t+s;return(0,i.jsxs)("div",{className:"w-full h-2.5 bg-gray-700 rounded overflow-hidden flex",children:[(0,i.jsx)("div",{className:"h-full bg-blue-500",style:{width:"".concat(n>0?t/n*100:50,"%")}}),(0,i.jsx)("div",{className:"h-full bg-red-500 flex-1"})]})}function _(){let e=(0,l.gT)(e=>e.game);if(!e)return null;let t=e.state.getAllPiecesFrom(f.GG.P1),s=e.state.getAllPiecesFrom(f.GG.P2),n=t.length,r=s.length,a=e.state.graveyard,o=a.filter(e=>e.owner===f.GG.P1),c=a.filter(e=>e.owner===f.GG.P2);return(0,i.jsxs)("div",{className:"flex flex-col gap-2 text-sm text-white",children:[(0,i.jsxs)("section",{className:"bg-gray-800 rounded p-2",children:[(0,i.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"Pieces"}),(0,i.jsxs)("div",{className:"flex justify-between text-xs mb-1",children:[(0,i.jsxs)("span",{className:"text-blue-400",children:["P1: ",n]}),(0,i.jsxs)("span",{className:"text-red-400",children:["P2: ",r]})]}),(0,i.jsx)(I,{p1:n,p2:r})]}),(0,i.jsxs)("section",{className:"bg-gray-800 rounded p-2",children:[(0,i.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"Captured"}),(0,i.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,i.jsxs)("div",{className:"text-blue-400",children:["P1 lost: ",o.length,o.length>0&&(0,i.jsxs)("span",{className:"text-gray-500 ml-1",children:["(",o.map(e=>e.symbol).join(""),")"]})]}),(0,i.jsxs)("div",{className:"text-red-400",children:["P2 lost: ",c.length,c.length>0&&(0,i.jsxs)("span",{className:"text-gray-500 ml-1",children:["(",c.map(e=>e.symbol).join(""),")"]})]})]})]}),(0,i.jsx)(L,{})]})}function B(){let e=(0,r.useRouter)(),t=(0,l.gT)(e=>e.game);return((0,n.useEffect)(()=>{t||e.push("/")},[t,e]),t)?(0,i.jsxs)("div",{className:"h-screen flex",children:[(0,i.jsx)(F,{}),(0,i.jsx)("div",{className:"flex-1 relative",children:(0,i.jsx)(G,{})}),(0,i.jsx)("div",{className:"w-[320px] p-2 bg-gray-900 overflow-y-auto",children:(0,i.jsx)(_,{})})]}):null}}},function(e){e.O(0,[21,819,346,971,117,744],function(){return e(e.s=9319)}),_N_E=e.O()}]);