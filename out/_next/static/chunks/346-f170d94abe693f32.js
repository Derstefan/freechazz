"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[346],{9376:function(e,t,o){var n=o(5475);o.o(n,"useRouter")&&o.d(t,{useRouter:function(){return n.useRouter}})},4369:function(e,t,o){var n=o(2265),l="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=n.useState,i=n.useEffect,s=n.useLayoutEffect,a=n.useDebugValue;function u(e){var t=e.getSnapshot;e=e.value;try{var o=t();return!l(e,o)}catch(e){return!0}}var f="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var o=t(),n=r({inst:{value:o,getSnapshot:t}}),l=n[0].inst,f=n[1];return s(function(){l.value=o,l.getSnapshot=t,u(l)&&f({inst:l})},[e,o,t]),i(function(){return u(l)&&f({inst:l}),e(function(){u(l)&&f({inst:l})})},[e]),a(o),o};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:f},2860:function(e,t,o){var n=o(2265),l=o(2558),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=l.useSyncExternalStore,s=n.useRef,a=n.useEffect,u=n.useMemo,f=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,o,n,l){var c=s(null);if(null===c.current){var p={hasValue:!1,value:null};c.current=p}else p=c.current;var g=i(e,(c=u(function(){function e(e){if(!a){if(a=!0,i=e,e=n(e),void 0!==l&&p.hasValue){var t=p.value;if(l(t,e))return s=t}return s=e}if(t=s,r(i,e))return t;var o=n(e);return void 0!==l&&l(t,o)?(i=e,t):(i=e,s=o)}var i,s,a=!1,u=void 0===o?null:o;return[function(){return e(t())},null===u?void 0:function(){return e(u())}]},[t,o,n,l]))[0],c[1]);return a(function(){p.hasValue=!0,p.value=g},[g]),f(g),g}},2558:function(e,t,o){e.exports=o(4369)},5195:function(e,t,o){e.exports=o(2860)},1989:function(e,t,o){var n,l;o.d(t,{W:function(){return n}}),(l=n||(n={})).RUSH_50="RUSH_50",l.ADVANCE_SAFE_20="ADVANCE_SAFE_20",l.ATTACK="ATTACK",l.FORMATION="FORMATION",l.COVER="COVER",l.EVADE="EVADE",l.DEFEND_KING="DEFEND_KING"},4562:function(e,t,o){o.d(t,{N:function(){return i},X:function(){return r}});var n=o(4552);let l=0;class r{get lvl(){return this.pieceType.pieceTypeId.lvl}get symbol(){return this.pieceType.symbol}get pos(){return this.position}isPossibleMove(e){for(let t of this.moveSet.getPossibleMoves())if(t.equals(e))return!0;return!1}copy(){var e,t;let o=new r(this.owner,this.pieceType);for(let l of(o.king=this.king,o.position=null!==(t=null===(e=this.position)||void 0===e?void 0:e.copy())&&void 0!==t?t:null,o.id=this.id,o.moveSet=new n.f,this.moveSet.getPossibleMoves()))o.moveSet.add(l.copy());return o}constructor(e,t){this.position=null,this.king=!1,this.moveSet=new n.f,this.distanceToEnemy=0,this.distanceToEnemyKing=0,this.distanceToOwnKing=0,this.id=l++,this.owner=e,this.pieceType=t}}function i(){l=0}},9013:function(e,t,o){let n;o.d(t,{Vx:function(){return W},Dm:function(){return C},gT:function(){return k}});let l=e=>{let t;let o=new Set,n=(e,n)=>{let l="function"==typeof e?e(t):e;if(!Object.is(l,t)){let e=t;t=(null!=n?n:"object"!=typeof l||null===l)?l:Object.assign({},t,l),o.forEach(o=>o(t,e))}},l=()=>t,r={setState:n,getState:l,getInitialState:()=>i,subscribe:e=>(o.add(e),()=>o.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},i=t=e(n,l,r);return r},r=e=>e?l(e):l;var i=o(2265),s=o(5195);let{useDebugValue:a}=i,{useSyncExternalStoreWithSelector:u}=s,f=!1,c=e=>e,p=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?r(e):e,o=(e,o)=>(function(e,t=c,o){o&&!f&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),f=!0);let n=u(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,o);return a(n),n})(t,e,o);return Object.assign(o,t),o};var g=o(4490),d=o(7676),m=o(3418),h=o(4464),v=o(406),y=o(4562),b=o(4094),S=o(6880),P=o(4892),w=o(1989);function E(e,t,o){let n=(0,m.Kc)(t),l=function(e,t){let o=new Set,n=e.width;for(let l of e.getAllPiecesFrom(t))for(let e of l.moveSet.getPossibleMoves())o.add(e.y*n+e.x);return o}(e,n),r=e.width,i=t===m.GG.P1?e.king2:e.king1,s=t===m.GG.P1?e.king1:e.king2,a=e.copy();return[function(e,t,o,n,l){let r=e.getAllPiecesFrom(t),i=[];for(let e of r){let t=[];for(let o of e.moveSet.getPossibleMoves())x(e,o.x,o.y,l)&&t.push(o);t.length>0&&i.push({piece:e,rushMoves:t})}A(i,o);let s=Math.ceil(.5*i.length),a=i.slice(0,s),u=[];for(let{piece:e,rushMoves:t}of a){let n=t[o.nextInt(t.length)];u.push(M(e,n))}return{type:w.W.RUSH_50,label:"Rush 50%",pieceCount:u.length,moves:u}}(e,t,o,0,i),function(e,t,o,n,l,r){let i=e.getAllPiecesFrom(t),s=[];for(let e of i){let t=[];for(let o of e.moveSet.getPossibleMoves())x(e,o.x,o.y,r)&&!n.has(o.y*l+o.x)&&t.push(o);t.length>0&&s.push({piece:e,safeMoves:t})}A(s,o);let a=Math.ceil(.2*s.length),u=s.slice(0,a),f=[];for(let{piece:e,safeMoves:t}of u){let n=t[o.nextInt(t.length)];f.push(M(e,n))}return{type:w.W.ADVANCE_SAFE_20,label:"Advance Safe 20%",pieceCount:f.length,moves:f}}(e,t,o,l,r,i),function(e,t,o,n,l){let r=e.getAllPiecesFrom(t),i=[];for(let t of r){let r=null,s=-1;for(let i of t.moveSet.getPossibleMoves()){let t=e.pieceAt(i);t&&t.owner===o&&!n.has(i.y*l+i.x)&&t.lvl>s&&(s=t.lvl,r=i)}r&&i.push(M(t,r))}return{type:w.W.ATTACK,label:"Attack",pieceCount:i.length,moves:i}}(e,t,n,l,r),function(e,t,o){var n,l;let r=e.getAllPiecesFrom(t),i=new Map;for(let e of r)for(let t of e.moveSet.getPossibleMoves()){let e=t.y*o+t.x;i.set(e,(null!==(n=i.get(e))&&void 0!==n?n:0)+1)}let s=new Set;for(let e of r){let t=e.pos.y*o+e.pos.x;(null!==(l=i.get(t))&&void 0!==l?l:0)===0&&s.add(t)}if(0===s.size)return{type:w.W.FORMATION,label:"Formation",pieceCount:0,moves:[]};let a=t===P.W.TOPDOWN_PLAYER,u=[];for(let e of r){if(0===s.size)break;let t=e.pieceType.actionMap.keySet();for(let n of e.moveSet.getPossibleMoves()){let l=[];for(let e of t){let t=e.x,r=e.y;a&&(r=-r);let i=(n.y+r)*o+(n.x+t);s.has(i)&&l.push(i)}if(l.length>0){for(let t of(u.push(M(e,n)),l))s.delete(t);break}}}return{type:w.W.FORMATION,label:"Formation",pieceCount:u.length,moves:u}}(e,t,r),function(e,t,o,n,l){let r=e.getAllPiecesFrom(t),i=e.getAllPiecesFrom(o);e.height;let s=t===P.W.TOPDOWN_PLAYER,a=[];for(let e of r){let t=1/0;for(let o of i){let n=Math.abs(e.pos.x-o.pos.x)+Math.abs(e.pos.y-o.pos.y);n<t&&(t=n)}a.push({piece:e,dist:t})}a.sort((e,t)=>e.dist-t.dist);let u=Math.max(1,Math.ceil(.4*a.length)),f=a.slice(0,u),c=[];for(let{piece:e}of f){let t=e.pos.y*l+e.pos.x;n.has(t)&&c.push(e)}if(0===c.length)return{type:w.W.COVER,label:"Cover",pieceCount:0,moves:[]};let p=new Set;for(let e of r)for(let t of e.moveSet.getPossibleMoves())p.add(t.y*l+t.x);let g=[];for(let e of c){let t=e.pos.y*l+e.pos.x;p.has(t)||g.push(e)}if(0===g.length){let t=c.map(e=>({x:e.pos.x,y:e.pos.y})),n=D(e,o,c,l);return{type:w.W.COVER,label:"Cover",pieceCount:0,moves:[],protectedCells:t,enemyCells:n}}let d=new Set(f.map(e=>e.piece.id)),m=r.filter(e=>!d.has(e.id)),h=[],v=[],y=new Set,b=new Set(g.map(e=>e.pos.y*l+e.pos.x));for(let e of g){let t=e.pos.y*l+e.pos.x;if(!b.has(t))continue;let o=!1;for(let n of m){if(y.has(n.id))continue;let l=n.pieceType.actionMap.keySet();for(let r of n.moveSet.getPossibleMoves()){let i=!1;for(let t of l){let o=t.x,n=t.y;s&&(n=-n);let l=r.x+o,a=r.y+n;if(l===e.pos.x&&a===e.pos.y){i=!0;break}}if(i){h.push(M(n,r)),y.add(n.id),v.push(e),b.delete(t),o=!0;break}}if(o)break}}let S=[...c.filter(e=>!b.has(e.pos.y*l+e.pos.x))],E=S.map(e=>({x:e.pos.x,y:e.pos.y})),x=D(e,o,S,l);return{type:w.W.COVER,label:"Cover",pieceCount:h.length,moves:h,protectedCells:E,enemyCells:x}}(e,t,n,l,r),function(e,t,o,n,l){let r=e.getAllPiecesFrom(t),i=[],s=new Set;for(let e of r){let t=e.pos.y*l+e.pos.x;if(n.has(t)){for(let o of(s.add(t),e.moveSet.getPossibleMoves()))if(!n.has(o.y*l+o.x)){i.push(M(e,o));break}}}let a=[],u=new Set;for(let t of e.getAllPiecesFrom(o))for(let e of t.moveSet.getPossibleMoves())if(s.has(e.y*l+e.x)){let e=t.pos.y*l+t.pos.x;u.has(e)||(u.add(e),a.push({x:t.pos.x,y:t.pos.y}));break}return{type:w.W.EVADE,label:"Evade Threats",pieceCount:i.length,moves:i,enemyCells:a}}(e,t,n,l,r),function(e,t,o,n,l){if(!o)return{type:w.W.DEFEND_KING,label:"Defend King",pieceCount:0,moves:[]};let r=o.pos.x,i=o.pos.y,s=e.height,a=t===P.W.TOPDOWN_PLAYER,u=e.getAllPiecesFrom(t),f=new Set;for(let e=-2;e<=2;e++)for(let t=-2;t<=2;t++){if(Math.abs(t)+Math.abs(e)>2||0===t&&0===e)continue;let o=r+t,n=i+e;o>=0&&o<l&&n>=0&&n<s&&f.add(n*l+o)}let c=new Set;for(let e of u)for(let t of e.moveSet.getPossibleMoves()){let e=t.y*l+t.x;f.has(e)&&c.add(e)}let p=new Set;for(let e of f)c.has(e)||p.add(e);if(0===p.size)return{type:w.W.DEFEND_KING,label:"Defend King",pieceCount:0,moves:[]};let g=[];for(let e of u){if(e===o)continue;let t=Math.abs(e.pos.x-r)+Math.abs(e.pos.y-i),n=e.pieceType.actionMap.keySet(),s=null,u=[];for(let t of e.moveSet.getPossibleMoves()){let e=[];for(let o of n){let n=o.x,r=o.y;a&&(r=-r);let i=(t.y+r)*l+(t.x+n);p.has(i)&&e.push(i)}e.length>u.length&&(s=t,u=e)}s&&u.length>0&&g.push({piece:e,move:s,coveredKeys:u,dist:t})}g.sort((e,t)=>e.dist-t.dist);let d=Math.max(5,Math.ceil(.1*u.length)),m=[],h=new Set;for(let e of g){if(m.length>=d||0===p.size)break;let t=e.coveredKeys.filter(e=>p.has(e));if(0!==t.length)for(let o of(m.push(M(e.piece,e.move)),t))p.delete(o),h.add(o)}return{type:w.W.DEFEND_KING,label:"Defend King",pieceCount:m.length,moves:m}}(e,t,s,0,r)].map(e=>{let o=e.moves.filter(e=>{let o=new v.Y(e.fromX,e.fromY),n=new v.Y(e.toX,e.toY),l=a.pieceAt(o);if(!l||l.owner!==t)return!1;let r=a.graveyard.length;a.history.addState(),l.pieceType.perform(a,o,n);let i=!1;for(let e=r;e<a.graveyard.length;e++)if(a.graveyard[e].owner===t){i=!0;break}return a.undoDraw(),!i});return{...e,moves:o,pieceCount:o.length}})}function x(e,t,o,n){if(!n)return!1;let l=n.pos.x,r=n.pos.y,i=Math.abs(e.pos.x-l)+Math.abs(e.pos.y-r);return Math.abs(t-l)+Math.abs(o-r)<i}function A(e,t){for(let o=e.length-1;o>0;o--){let n=t.nextInt(o+1),l=e[o];e[o]=e[n],e[n]=l}}function M(e,t){return{fromX:e.pos.x,fromY:e.pos.y,toX:t.x,toY:t.y}}function D(e,t,o,n){let l=new Set;for(let e of o)l.add(e.pos.y*n+e.pos.x);let r=[],i=new Set;for(let o of e.getAllPiecesFrom(t))for(let e of o.moveSet.getPossibleMoves())if(l.has(e.y*n+e.x)){let e=o.pos.y*n+o.pos.x;i.has(e)||(i.add(e),r.push({x:o.pos.x,y:o.pos.y}));break}return r}function T(e){let t=e.state.getAllPiecesFrom(m.GG.P1),o=e.state.getAllPiecesFrom(m.GG.P2);return{turn:e.getTurns(),p1Material:t.reduce((e,t)=>e+t.lvl,0),p2Material:o.reduce((e,t)=>e+t.lvl,0),p1Count:t.length,p2Count:o.length}}let k=(n=(e,t)=>({config:{sizeName:"tiny",mode:"bot",botDepth:2,seed:null,samePieces:!0,botActions:!1},game:null,selectedPiece:null,possibleMoves:[],winner:null,botThinking:!1,botWorker:null,moveHistory:[],formationSeed1:0,formationSeed2:0,firstTurn:m.GG.P1,pendingDrawEvent:null,computedActions:null,pendingParallelDraw:!1,hoveredAction:null,materialHistory:[],setConfig:t=>{e(e=>({config:{...e.config,...t}}))},startGame:()=>{var o;let{config:n}=t(),l=t();l.botWorker&&l.botWorker.terminate(),(0,y.N)();let r=h.v[n.sizeName],i=null!==(o=n.seed)&&void 0!==o?o:Math.floor(999999999*Math.random()),s=n.samePieces?i:i+1,a=new d.s(i,r).generate(),u=new d.s(s,r).generate(),f=m.GG.P1,c=new g.E(a,u).firstPlayer(f).build(),p=n.botActions?E(c.state,m.GG.P1,new S.R(i+777)):null;e({game:c,selectedPiece:null,possibleMoves:[],winner:null,botThinking:!1,botWorker:null,moveHistory:[],formationSeed1:i,formationSeed2:s,firstTurn:f,pendingDrawEvent:null,computedActions:p,pendingParallelDraw:!1,materialHistory:[T(c)]})},selectPiece:o=>{let{game:n}=t();if(!n)return;let l=n.state.pieceAt(o);if(!l){e({selectedPiece:null,possibleMoves:[]});return}e({selectedPiece:l,possibleMoves:[...l.moveSet.getPossibleMoves()]})},tryMove:o=>{let{game:n,selectedPiece:l,config:r,botThinking:i}=t();if(!n||!l||i||n.getWinner()||"bot"===r.mode&&n.getPlayersTurn()!==m.GG.P1)return;let s=l.pos;if(n.play(s,o)){let l=n.getLastDrawEvent(),i=[...t().moveHistory,{fromX:s.x,fromY:s.y,toX:o.x,toY:o.y}],a=n.getWinner();e({selectedPiece:null,possibleMoves:[],winner:a,moveHistory:i,game:n,pendingDrawEvent:l,materialHistory:[...t().materialHistory,T(n)]}),l||a||"bot"!==r.mode||n.getPlayersTurn()!==m.GG.P2||W()}},clickCell:o=>{let{game:n,selectedPiece:l,possibleMoves:r,botThinking:i,config:s}=t();if(!(!n||i||n.getWinner())){if(s.botActions){n.state.pieceAt(o)?t().selectPiece(o):e({selectedPiece:null,possibleMoves:[]});return}if(l&&r.some(e=>e.x===o.x&&e.y===o.y)){t().tryMove(o);return}n.state.pieceAt(o)?t().selectPiece(o):e({selectedPiece:null,possibleMoves:[]})}},undoMove:()=>{let{game:o,config:n}=t();if(o&&0!==o.getTurns()){if("bot"===n.mode&&o.getTurns()>=2){o.undo(),o.undo();let n=t().moveHistory.slice(0,-2),l=o.getTurns();e({selectedPiece:null,possibleMoves:[],winner:null,moveHistory:n,game:o,pendingDrawEvent:null,materialHistory:[...t().materialHistory.filter(e=>e.turn<=l),T(o)]})}else{o.undo();let n=t().moveHistory.slice(0,-1),l=o.getTurns();e({selectedPiece:null,possibleMoves:[],winner:null,moveHistory:n,game:o,pendingDrawEvent:null,materialHistory:[...t().materialHistory.filter(e=>e.turn<=l),T(o)]})}}},setHoveredAction:t=>{e({hoveredAction:t})},executeBotAction:o=>{let{game:n,config:l,botThinking:r}=t();if(!n||r||n.getWinner()||0===o.moves.length||!n.playBatch(o.moves))return;let i=n.getLastDrawEvent(),s=n.getWinner();e({selectedPiece:null,possibleMoves:[],winner:s,game:n,pendingDrawEvent:i,pendingParallelDraw:!0,computedActions:null,hoveredAction:null,materialHistory:[...t().materialHistory,T(n)]}),i||s||"bot"!==l.mode||n.getPlayersTurn()!==m.GG.P2||C()},cleanup:()=>{let{botWorker:o}=t();o&&o.terminate(),e({game:null,botWorker:null,botThinking:!1,selectedPiece:null,possibleMoves:[],pendingDrawEvent:null,computedActions:null,pendingParallelDraw:!1,hoveredAction:null,materialHistory:[]})}}))?p(n):p;function W(){let{game:e,config:t,formationSeed1:n,formationSeed2:l,moveHistory:r,firstTurn:i}=k.getState();e&&(k.setState({botThinking:!0}),setTimeout(()=>{try{let e=new Worker(o.tu(new URL(o.p+o.u(229),o.b)),{type:void 0});e.onmessage=t=>{let o=t.data,n=k.getState(),l=n.game;if(l){if("result"===o.type){let e=new v.Y(o.fromX,o.fromY),t=new v.Y(o.toX,o.toY);if(l.play(e,t)){let e=l.getLastDrawEvent(),t=[...n.moveHistory,{fromX:o.fromX,fromY:o.fromY,toX:o.toX,toY:o.toY}];k.setState({winner:l.getWinner(),botThinking:!1,botWorker:null,moveHistory:t,game:l,pendingDrawEvent:e,materialHistory:[...n.materialHistory,T(l)]})}else k.setState({botThinking:!1,botWorker:null})}else l.surrender(),k.setState({winner:l.getWinner(),botThinking:!1,botWorker:null});e.terminate()}},e.onerror=()=>{G(),e.terminate()};let s={type:"compute",gameSnapshot:{formation1Data:{sizeName:t.sizeName,seed:n,samePieces:t.samePieces,formationSeed:n},formation2Data:{sizeName:t.sizeName,seed:l,samePieces:t.samePieces,formationSeed:l},moves:r,firstTurn:i},botPlayer:m.GG.P2,maxDepth:t.botDepth};k.setState({botWorker:e}),e.postMessage(s)}catch(e){G()}},10))}function G(){let e=k.getState(),{game:t,config:o}=e;if(!t)return;let n=new b.r(m.GG.P2,o.botDepth),l=t.copy(),r=n.doDrawOn(l);if(r){let o=r.fromPos,n=r.toPos;t.play(o,n);let l=t.getLastDrawEvent(),i=[...e.moveHistory,{fromX:o.x,fromY:o.y,toX:n.x,toY:n.y}];k.setState({winner:t.getWinner(),botThinking:!1,moveHistory:i,game:t,pendingDrawEvent:l,materialHistory:[...e.materialHistory,T(t)]})}else t.surrender(),k.setState({winner:t.getWinner(),botThinking:!1})}function C(){let{game:e,formationSeed1:t}=k.getState();e&&(k.setState({botThinking:!0}),setTimeout(()=>{let e=k.getState().game;if(!e)return;let o=new S.R(t+31*e.getTurns()),n=function(e,t,o){let n=E(e.state,t,o),l=n[0],r=-1/0;for(let o of n){if(0===o.moves.length)continue;let n=e.copy();n.playBatch(o.moves);let i=function(e,t){let o=e.state,n=(0,m.Kc)(t),l=0,r=o.getAllPiecesFrom(t),i=o.getAllPiecesFrom(n);for(let e of r)l+=e.king?2e3:10*e.lvl;for(let e of i)l-=e.king?2e3:10*e.lvl;let s=t===m.GG.P1?o.king1:o.king2;for(let e of(t===m.GG.P1?o.king2:o.king1,s&&(l+=1*o.distanceToEnemy(n,s.pos)),r))e.king||(l-=.1*o.distanceToEnemy(n,e.pos));let a=e.getWinner();return a===t?l+=1e5:a===n&&(l-=1e5),l}(n,t);i>r&&(r=i,l=o)}return l}(e,m.GG.P2,o);if(0===n.moves.length){e.surrender(),k.setState({winner:e.getWinner(),botThinking:!1});return}e.playBatch(n.moves);let l=e.getLastDrawEvent(),r=e.getWinner(),i=r?null:E(e.state,m.GG.P1,new S.R(t+17*e.getTurns()));k.setState({winner:r,botThinking:!1,game:e,pendingDrawEvent:l,pendingParallelDraw:!0,computedActions:i,materialHistory:[...k.getState().materialHistory,T(e)]})},10))}}}]);