"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{4094:function(t,e,s){s.d(e,{r:function(){return n}});var i=s(6880);class r{getPlayer(){return this.player}doDrawOn(t){return this.drawsCounter=0,this.doDraw(t)}newDraw(){this.drawsCounter++}randomDraw(t){if(0===t.length)throw Error("Draws list is empty");let e=Math.floor(this.rand.next()*t.length);return t[e]}static diff(t,e){return t.filter(t=>!e.includes(t))}static getBestDrawsWithTolerance(t,e){if(e>1||e<0)throw Error("Tolerance must be between 0 and 1");let s=-Number.MAX_VALUE;for(let e of t.values())e>s&&(s=e);let i=[];for(let[r,o]of t.entries())o>=s-Math.abs(s*e)&&i.push(r);return i}constructor(t,e){this.drawsCounter=0,this.player=t,this.rand=new i.R(null!=e?e:Math.floor(1213987*Math.random()))}}var o=s(3418);class n extends r{doDraw(t){let e=this.evaluateDraws(t);if(0===e.size)return null;let s=r.getBestDrawsWithTolerance(e,.2);return this.randomDraw(s)}evaluateDraws(t){let e=t.copy(),s=new Map,i=this.getDraws(t,t.getPlayersTurn());if(0===i.length)return s;let r=-Number.MAX_VALUE/4,o=0,n=0;for(let t of i){let i=this.emulateOwnDraw(e,t,this.maxDepth);if(i>r&&(r=i,n=o),i<=-Number.MAX_VALUE/4){o++;continue}if(s.set(t,i),i===Number.MAX_VALUE)return s;if(o>7&&o-n>4)break;o++}if(0===s.size){if(0===i.length)return s;s.set(this.randomDraw(i),0)}return s}emulateOwnDraw(t,e,s){let i=[...t.state.graveyard];t.play(e.fromPos,e.toPos),this.newDraw();let r=t.state.graveyard,o=this.weightOf(this.evaluateDraw(t,e,i,r),s);if(s===this.maxDepth&&o>=this.weightOf(1885,this.maxDepth)/2)return t.undo(),Number.MAX_VALUE;if(s===this.maxDepth-1&&o<=-this.weightOf(1885,this.maxDepth-1)/2)return t.undo(),-Number.MAX_VALUE/2;if(0===s)return t.undo(),o;let n=this.getDraws(t,t.getPlayersTurn());if(0===n.length)return t.undo(),-Number.MAX_VALUE/4;let h=-1e6,a=1,c=0,u=0;for(let e of n){let i=this.emulateEnemyDraw(t,e,s-1);if(u+=i,i>h&&(h=i,c=a),++a>5&&a-c>4)break}return o+=u/a,t.undo(),o}emulateEnemyDraw(t,e,s){let i=[...t.state.graveyard];t.play(e.fromPos,e.toPos),this.newDraw();let r=t.state.graveyard,o=this.weightOf(this.evaluateDraw(t,e,i,r),s);if(s===this.maxDepth&&o>=this.weightOf(1885,this.maxDepth)/2)return t.undo(),Number.MAX_VALUE;if(s===this.maxDepth-1&&o<=-this.weightOf(1885,this.maxDepth-1)/2)return t.undo(),-Number.MAX_VALUE/2;if(0===s)return t.undo(),o;let n=this.getDraws(t,t.getPlayersTurn());if(0===n.length)return t.undo(),-Number.MAX_VALUE/4;let h=1e6,a=1,c=0,u=0;for(let e of n){let i=this.emulateOwnDraw(t,e,s-1);if(u+=i,i<h&&(h=i,c=a),++a>5&&a-c>4)break}return o+=u/a,t.undo(),o}getDraws(t,e){let s=[];for(let i of t.state.getAllPiecesFrom(e))for(let t of i.moveSet.getPossibleMoves())s.push({fromPos:i.pos,toPos:t});return this.sortDrawData(s,t),s}sortDrawData(t,e){if(0===t.length)return;let s=e.state.pieceAt(t[0].fromPos);if(!s)return;let i=(0,o.Kc)(s.owner);t.sort((t,s)=>e.state.distanceToEnemy(i,t.toPos)-e.state.distanceToEnemy(i,s.toPos))}evaluateDraw(t,e,s,i){let n=0,h=t.state.distanceToEnemy((0,o.Kc)(this.player),e.fromPos)-t.state.distanceToEnemy((0,o.Kc)(this.player),e.toPos);for(let t of(h>0?n+=10:h<0&&(n-=10),r.diff(i,s)))n+=this.evaluateRemovedPiece(t);return n}evaluateRemovedPiece(t){return t.king?this.player===t.owner?-1885:1885:this.player===t.owner?-15:30}weightOf(t,e){let s=this.maxDepth-e+1;return t/s/s}constructor(t,e,s){super(t,s),this.maxDepth=e}}},3418:function(t,e,s){var i,r;function o(t){return"P1"===t?"P2":"P1"}function n(){return Math.random()>.5?"P1":"P2"}s.d(e,{GG:function(){return i},Kc:function(){return o},s9:function(){return n}}),(r=i||(i={})).P1="P1",r.P2="P2"},4464:function(t,e,s){s.d(e,{v:function(){return i}});let i={tiny:{width:10,height:10,name:"tiny"},small:{width:15,height:15,name:"small"},medium:{width:20,height:20,name:"medium"},big:{width:30,height:30,name:"big"},huge:{width:50,height:33,name:"huge"},massive:{width:100,height:50,name:"massive"},gigantic:{width:500,height:200,name:"gigantic"}}},406:function(t,e,s){s.d(e,{Y:function(){return i}});class i{add(t,e){return new i(this.x+t,this.y+e)}minus(t){return new i(this.x-t.x,this.y-t.y)}plus(t){return new i(this.x+t.x,this.y+t.y)}invertY(){return new i(this.x,-this.y)}equals(t){return!!t&&this.x===t.x&&this.y===t.y}getPosAround(){return[new i(this.x-1,this.y-1),new i(this.x,this.y-1),new i(this.x+1,this.y-1),new i(this.x-1,this.y),new i(this.x+1,this.y),new i(this.x-1,this.y+1),new i(this.x,this.y+1),new i(this.x+1,this.y+1)]}copy(){return new i(this.x,this.y)}compareTo(t){return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0}get key(){return"".concat(this.x,",").concat(this.y)}toString(){return"(x=".concat(this.x,",y=").concat(this.y,")")}static fromKey(t){let[e,s]=t.split(",").map(Number);return new i(e,s)}constructor(t,e){this.x=t,this.y=e}}},3375:function(t,e,s){var i,r;s.d(e,{j:function(){return o},t:function(){return i}}),(r=i||(i={})).CHANGE_OWNER="CHANGE_OWNER",r.CHANGE_TYPE="CHANGE_TYPE",r.DESTROY="DESTROY",r.MOVE="MOVE",r.SWAP="SWAP",r.ACT="ACT",r.MOVE_AND_DESTROY="MOVE_AND_DESTROY";class o{constructor(t){this.type=t}}},4490:function(t,e,s){s.d(e,{E:function(){return P}});var i=s(3418),r=s(406),o=s(4562);class n{constructor(t=null){this.piece=t}}class h{pieceAt(t){return t.x<0||t.x>=this.width||t.y<0||t.y>=this.height?null:this.board[t.y][t.x].piece}isFree(t){return!this.isOnboard(t)||null===this.board[t.y][t.x].piece}isOnboard(t){return t.x>=0&&t.x<this.width&&t.y>=0&&t.y<this.height}areEnemies(t,e){return!!t&&!!e&&t.owner!==e.owner}removePiece(t){let e=this.pieceAt(t);if(e){let s=this.pieces.indexOf(e);s>=0&&this.pieces.splice(s,1),this.board[t.y][t.x].piece=null}}putPiece(t,e){t.position=e,this.pieces.push(t),this.board[e.y][e.x].piece=t}getBoardArray(){return this.board}copy(){let t=new h(this.width,this.height);for(let e=0;e<this.height;e++)for(let s=0;s<this.width;s++){let i=this.board[e][s].piece;if(i){let r=i.copy();t.board[e][s].piece=r,t.pieces.push(r)}}return t}constructor(t,e){this.pieces=[],this.width=t,this.height=e,this.board=[];for(let s=0;s<e;s++){this.board[s]=[];for(let e=0;e<t;e++)this.board[s][e]=new n}}}class a{addEvent(t){this.events.push(t)}getEvents(){return this.events}getLastEvent(){return this.events.length>0?this.events[this.events.length-1]:null}removeLastEvent(){this.events.length>0&&this.events.pop()}getEventCount(){return this.events.length}constructor(){this.events=[]}}class c{constructor(){this.drawEvent=new a}}class u{addEvent(t){this.getLastDraw().addEvent(t)}addState(){this.historyStates.push(new c)}getLastDraw(){let t=this.getLastState();return t?t.drawEvent:null}getDraw(t){let e=this.getHistoryState(t);return e?e.drawEvent:null}removeLastState(){this.historyStates.length>0&&this.historyStates.pop()}getLastState(){return this.historyStates.length>0?this.historyStates[this.historyStates.length-1]:null}getHistoryState(t){return this.historyStates.length>t?this.historyStates[t]:null}getStateCount(){return this.historyStates.length}copy(){return new u}constructor(){this.historyStates=[],this.addState()}}class l{static getInstance(t,e){return new l(t,e)}performDraw(t,e){let s=this.pieceAt(t);s&&(this.history.addState(),s.pieceType.perform(this,t,e),this.computePossibleMoves())}performEvent(t){this.history.addEvent(t),t.perform(this)}undoDraw(){let t=this.history.getLastDraw();if(!t)return;let e=t.getEventCount();for(let s=0;s<e;s++)this.undoEvent(t.getLastEvent());this.history.removeLastState()}undoEvent(t){var e;t.undo(this),null===(e=this.history.getLastDraw())||void 0===e||e.removeLastEvent()}pieceAt(t){return this.board.pieceAt(t)}isFree(t){return this.board.isFree(t)}isOnboard(t){return this.board.isOnboard(t)}areEnemies(t,e){return this.board.areEnemies(t,e)}removePiece(t){this.board.removePiece(t)}putPiece(t,e){this.board.putPiece(t,e)}computePossibleMoves(){for(let t of this.board.pieces)this.computePossibleMovesForPiece(t)}computePossibleMovesForPiece(t){let e=t.pos;t.moveSet=t.pieceType.computePossibleMoves(this,e)}distanceToEnemy(t,e){let s=9e3;for(let i of this.getAllPiecesFrom(t)){let t=Math.abs(e.x-i.pos.x)+Math.abs(e.y-i.pos.y);t<s&&(s=t)}return s}getAllPieces(){return this.board.pieces}getAllPiecesFrom(t){return this.board.pieces.filter(e=>e.owner===t)}getBoardArray(){return this.board.getBoardArray()}getWinner(){return this._winner}setWinner(t){this._winner=t}setKing1(t){t.king=!0,this.king1=t}setKing2(t){t.king=!0,this.king2=t}setHistory(t){this.history=t}copy(){let t=new l(this.width,this.height);if(t.board=this.board.copy(),t._winner=this._winner,t.graveyard=this.graveyard.map(t=>t.copy()),t.history=this.history.copy(),t.isCopy=!0,this.king1){let e=t.board.pieces.find(t=>t.id===this.king1.id);e&&(e.king=!0,t.king1=e)}if(this.king2){let e=t.board.pieces.find(t=>t.id===this.king2.id);e&&(e.king=!0,t.king2=e)}return t}constructor(t,e){this.king1=null,this.king2=null,this._winner=null,this.playersTurn=i.GG.P1,this.graveyard=[],this.isCopy=!1,this.width=t,this.height=e,this.board=new h(t,e),this.history=new u}}class d{putPiece(t,e){return t.id=this.idCounter++,this.state.putPiece(t,e),this}putPieceMirrored(t,e){return this.putPiece(t,this.mirrorPos(e)),this}mirrorPos(t){return new r.Y(this.width-1-t.x,this.height-1-t.y)}putKing(t,e,s){let r=new o.X(t,e);return t===i.GG.P1?(this.putPieceMirrored(r,s),this.state.setKing1(r),this.king1Set=!0):(this.putPiece(r,s),this.state.setKing2(r),this.king2Set=!0),this}build(){return this.king1Set&&this.king2Set?(this.state.computePossibleMoves(),this.state.setHistory(new u),this.state):null}constructor(t,e){this.king1Set=!1,this.king2Set=!1,this.idCounter=0,this.width=t,this.height=e,this.state=l.getInstance(t,e)}}class p{play(t,e){return!!this.validateDrawLogic(t,e)&&(this.state.performDraw(t,e),this.endTurn(),!0)}playBatch(t){if(this.state.getWinner())return!1;let e=this.getPlayersTurn();for(let s of(this.state.history.addState(),t)){let t=new r.Y(s.fromX,s.fromY),i=new r.Y(s.toX,s.toY),o=this.state.pieceAt(t);if(o&&o.owner===e&&o.pieceType.isPossibleMove(this.state,t,i)&&(o.pieceType.perform(this.state,t,i),this.state.getWinner()))break}return this.state.computePossibleMoves(),this.setPlayersTurn((0,i.Kc)(e)),this.turns++,!0}surrender(){this.getPlayersTurn()===i.GG.P1?this.state.setWinner(i.GG.P2):this.state.setWinner(i.GG.P1)}computePossibleMoves(){this.state.computePossibleMoves()}getLastDrawEvent(){return this.state.history.getLastDraw()}getDrawsSince(t){let e=[];for(let s=t;s<this.turns;s++){let t=this.state.history.getDraw(s);t&&e.push(t)}return e}endTurn(){this.state.getWinner()||(this.changeTurn(),this.state.isCopy||this.computePossibleMoves())}changeTurn(){this.setPlayersTurn((0,i.Kc)(this.getPlayersTurn())),this.turns++}validateDrawLogic(t,e){if(this.state.getWinner())return!1;let s=this.state.pieceAt(t);return!!(s&&s.owner===this.getPlayersTurn()&&this.canMoveTo(t,e))}canMoveTo(t,e){let s=this.state.pieceAt(t);return!!s&&s.pieceType.isPossibleMove(this.state,t,e)}getPlayersTurn(){return this.state.playersTurn}setPlayersTurn(t){this.state.playersTurn=t}getTurns(){return this.turns}getWinner(){return this.state.getWinner()}copy(){let t=Object.create(p.prototype);return t.formation1=this.formation1,t.formation2=this.formation2,t.turns=this.turns,t.state=this.state.copy(),t.setPlayersTurn(this.getPlayersTurn()),t}undo(){this.state.undoDraw(),this.setPlayersTurn((0,i.Kc)(this.getPlayersTurn())),this.turns--}constructor(t,e){this.turns=0,this.formation1=t,this.formation2=e;let s=new d(t.size.width,t.size.height);for(let[e,n]of(s.putKing(i.GG.P1,t.getKing(),t.kingPos),t.getPieceTypes())){let h=r.Y.fromKey(e);h.equals(t.kingPos)||s.putPieceMirrored(new o.X(i.GG.P1,n),h)}for(let[t,n]of(s.putKing(i.GG.P2,e.getKing(),e.kingPos),e.getPieceTypes())){let h=r.Y.fromKey(t);h.equals(e.kingPos)||s.putPiece(new o.X(i.GG.P2,n),h)}this.state=s.build()}}class P{randomStarter(){return this.firstTurn=(0,i.s9)(),this}firstTurnP1(){return this.firstTurn=i.GG.P1,this}firstTurnP2(){return this.firstTurn=i.GG.P2,this}firstPlayer(t){return this.firstTurn=t,this}build(){if(!this.firstTurn)throw Error("First turn is not set");let t=new p(this.formation1,this.formation2);return t.setPlayersTurn(this.firstTurn),t.computePossibleMoves(),t}constructor(t,e){this.firstTurn=null,this.formation1=t,this.formation2=e}}},7676:function(t,e,s){s.d(e,{s:function(){return tf}});class i{put(t,e){this.pieceTypes.set(e.key,t)}getPieceTypes(){return this.pieceTypes}getKing(){var t;return this.kingPos&&null!==(t=this.pieceTypes.get(this.kingPos.key))&&void 0!==t?t:null}getPieceTypeAt(t){var e;return null!==(e=this.pieceTypes.get(t.key))&&void 0!==e?e:null}copy(){let t=new i(this.size);return t.kingPos=this.kingPos,t.pieceTypes=new Map(this.pieceTypes),t}constructor(t){this.pieceTypes=new Map,this.kingPos=null,this.size=t}}class r{putKing(t,e){return this.formation.kingPos=e,this.formation.put(t,e),this.kingSet=!0,this}putPiece(t,e){return this.formation.put(t,e),this}build(){if(!this.kingSet)throw Error("King not set");return this.formation}constructor(t){this.kingSet=!1,this.formation=new i(t)}}var o,n,h,a,c=s(406),u=s(6880);class l{getRandomPieceType(t){let e=this.pool.get(t);return e[this.rand.nextInt(e.length)]}get(t){return this.pool.get(t)}put(t,e){this.pool.set(t,e)}constructor(t,e){this.pool=new Map,this.rand=new u.R(e);for(let e=1;e<=t;e++)this.pool.set(e,[])}}var d=s(4892),p=s(5953);class P{AND(t){return new A(this,t)}OR(t){return new f(this,t)}NOT(){return new g(this)}}class T extends P{check(t,e,s){return this.checkUnitary(t,s)}}class A extends P{check(t,e,s){return this.cond1.check(t,e,s)&&this.cond2.check(t,e,s)}constructor(t,e){super(),this.cond1=t,this.cond2=e}}class f extends P{check(t,e,s){return this.cond1.check(t,e,s)||this.cond2.check(t,e,s)}constructor(t,e){super(),this.cond1=t,this.cond2=e}}class g extends P{check(t,e,s){return!this.cond.check(t,e,s)}constructor(t){super(),this.cond=t}}class m extends P{check(t,e,s){return!0}}class _{static simple(t){return new _(new m,t)}checkCondition(t,e,s){return this.condition.check(t,e,s)}perform(t,e,s){this.checkCondition(t,e,s)&&this.act.perform(t,e,s)}performWithoutChain(t,e,s){this.checkCondition(t,e,s)&&this.act.performWithoutChain(t,e,s)}copy(){return new _(this.condition,this.act.copy(),this.symbol)}constructor(t,e,s=""){this.condition=t,this.act=e,this.symbol=s}}(o=h||(h={})).pos="pos",o.posAround="posAround",o.toPos="toPos",o.fromPos="fromPos",o.toPosAround="toPosAround",o.fromPosAround="fromPosAround";class y{performBinary(t,e,s){for(let[i,r]of this.nextActs)switch(i){case h.fromPos:r.performWithoutChain(t,e);break;case h.toPos:r.performWithoutChain(t,s);break;case h.fromPosAround:for(let s of e.getPosAround())r.performWithoutChain(t,s);break;case h.toPosAround:for(let e of s.getPosAround())r.performWithoutChain(t,e)}}performUnitary(t,e){for(let[s,i]of this.nextActs)switch(s){case h.pos:i.performWithoutChain(t,e);break;case h.posAround:for(let s of e.getPosAround())i.performWithoutChain(t,s)}}addChain(t,e){this.nextActs.set(t,e)}getNextActs(){return this.nextActs}constructor(t){this.previousAct=null,this.nextActs=new Map,this.previousAct=null!=t?t:null}}class E{getConnector(){return this.connector}setConnector(t){this.connector=t}createConnector(){return this.connector=new y(this),this.connector}toString(){return this.constructor.name}constructor(){this.connector=null}}class w extends E{perform(t,e){this.performWithoutChain(t,e),this.connector&&this.connector.performUnitary(t,e)}copy(){let t=Object.create(Object.getPrototypeOf(this));return t.connector=null,t}}var C=s(3375);class O extends C.j{perform(t){let e=t.pieceAt(this.pos);e&&(e===t.king1&&t.king2?t.setWinner(t.king2.owner):e===t.king2&&t.king1&&t.setWinner(t.king1.owner),t.removePiece(this.pos),t.graveyard.push(e))}undo(t){let e=t.graveyard.indexOf(this.piece);e>=0&&t.graveyard.splice(e,1),t.putPiece(this.piece,this.pos)}constructor(t,e){super(C.t.DESTROY),this.piece=t,this.pos=e}}class S extends w{performWithoutChain(t,e){let s=t.pieceAt(e);s&&t.performEvent(new O(s,e))}}class R extends E{perform(t,e,s){this.performWithoutChain(t,e,s),this.connector&&this.connector.performBinary(t,e,s)}copy(){let t=Object.create(Object.getPrototypeOf(this));return t.connector=null,t}}class M extends C.j{perform(t){let e=t.pieceAt(this.toPos),s=t.pieceAt(this.fromPos);null===e&&s&&(t.removePiece(this.fromPos),t.putPiece(s,this.toPos))}undo(t){t.removePiece(this.toPos),t.putPiece(this.piece,this.fromPos)}constructor(t,e,s){super(C.t.MOVE),this.fromPos=t,this.piece=e,this.toPos=s}}class W extends R{performWithoutChain(t,e,s){let i=t.pieceAt(e);null===t.pieceAt(s)&&i&&t.performEvent(new M(e,i,s))}}class N extends C.j{perform(t){let e=t.pieceAt(this.toPos),s=t.pieceAt(this.fromPos);e&&s&&(e===t.king1&&t.king2?t.setWinner(t.king2.owner):e===t.king2&&t.king1&&t.setWinner(t.king1.owner),t.removePiece(this.toPos),t.graveyard.push(e),t.removePiece(this.fromPos),t.putPiece(s,this.toPos))}undo(t){t.removePiece(this.toPos),t.putPiece(this.piece,this.fromPos);let e=t.graveyard.indexOf(this.targetPiece);e>=0&&t.graveyard.splice(e,1),t.putPiece(this.targetPiece,this.toPos)}constructor(t,e,s,i){super(C.t.MOVE_AND_DESTROY),this.fromPos=t,this.piece=e,this.toPos=s,this.targetPiece=i}}class v extends R{performWithoutChain(t,e,s){if(!t.isOnboard(s))return;let i=t.pieceAt(e),r=t.pieceAt(s);null!==r&&null!==i&&t.performEvent(new N(e,i,s,r)),null===r&&i&&t.performEvent(new M(e,i,s))}}class I extends R{performWithoutChain(t,e,s){j.DESTROY_PIECE_ACT.performWithoutChain(t,s)}}var x=s(3418);class K extends C.j{perform(t){this.piece.owner=(0,x.Kc)(this.piece.owner)}undo(t){this.piece.owner=(0,x.Kc)(this.piece.owner)}constructor(t){super(C.t.CHANGE_OWNER),this.piece=t}}class k extends R{performWithoutChain(t,e,s){let i=t.pieceAt(e),r=t.pieceAt(s);r&&i&&r.owner!==i.owner&&t.performEvent(new K(r))}}class b extends w{performWithoutChain(t,e){j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(-1,-1)),j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(0,-1)),j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(1,-1)),j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(-1,0)),j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(0,0)),j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(1,0)),j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(-1,1)),j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(0,1)),j.DESTROY_PIECE_ACT.performWithoutChain(t,e.add(1,1))}}class Y extends w{performWithoutChain(t,e){if(!t.pieceAt(e))return;let s=new c.Y(t.width-1-e.x,t.height-1-e.y);j.MOVE_OR_ATTACK.perform(t,e,s)}}class D extends C.j{perform(t){let e=t.pieceAt(this.fromPos),s=t.pieceAt(this.toPos);e&&s&&(t.removePiece(this.fromPos),t.removePiece(this.toPos),t.putPiece(e,this.toPos),t.putPiece(s,this.fromPos))}undo(t){let e=t.pieceAt(this.fromPos),s=t.pieceAt(this.toPos);s&&e&&(t.removePiece(this.fromPos),t.removePiece(this.toPos),t.putPiece(s,this.fromPos),t.putPiece(e,this.toPos))}constructor(t,e){super(C.t.SWAP),this.fromPos=t,this.toPos=e}}class L extends R{performWithoutChain(t,e,s){let i=t.pieceAt(e),r=t.pieceAt(s);r&&i&&r.owner===i.owner&&t.performEvent(new D(e,s))}}class B extends R{performWithoutChain(t,e,s){if(e.equals(s))return;let i=e.y-s.y,r=e.x-s.x,o=Math.max(Math.abs(i),Math.abs(r)),n=e.x,h=e.y;j.MOVE_OR_ATTACK.perform(t,e,s);for(let e=1;e<o;e++){n-=Math.trunc(r/o),h-=Math.trunc(i/o);let e=new c.Y(n,h);if(!t.isFree(e)){let s=t.pieceAt(e);s&&t.performEvent(new O(s,e))}}}}class V extends R{performWithoutChain(t,e,s){let i=t.pieceAt(e);if(!i)return;let r=i.owner;for(let e of[t.pieceAt(s.add(1,1)),t.pieceAt(s.add(-1,1)),t.pieceAt(s.add(1,-1)),t.pieceAt(s.add(-1,-1))])e&&e.owner!==r&&j.DESTROY_PIECE_ACT.performWithoutChain(t,e.pos);j.MOVE_ACT.perform(t,e,s)}}class G extends R{performWithoutChain(t,e,s){j.MOVE_ACT.performWithoutChain(t,e,s),j.EXPLOSION_ACT.performWithoutChain(t,s)}}var U=s(4562);class H extends C.j{perform(t){this.piece.pieceType=this.newType}undo(t){this.piece.pieceType=this.oldType}constructor(t,e,s){super(C.t.CHANGE_TYPE),this.piece=t,this.oldType=e,this.newType=s}}class X extends R{performWithoutChain(t,e,s){let i=t.pieceAt(e),r=t.pieceAt(s);if(r&&i&&r.owner!==i.owner){let e=new U.X(i.owner,i.pieceType);t.performEvent(new K(e)),t.performEvent(new H(e,e.pieceType,i.pieceType))}}}class F extends R{performWithoutChain(t,e,s){let i=t.pieceAt(e);if(!i)return;let r=i.owner,o=s.minus(e);for(let n of(j.MOVE_OR_ATTACK.perform(t,e,s),[...t.getAllPiecesFrom(r)]))n.id!==i.id&&n.symbol===i.symbol&&t.isOnboard(n.pos.plus(o))&&tn.MOVE_OR_ATTACK_ACTION.perform(t,n.pos,n.pos.plus(o))}}class z extends R{performWithoutChain(t,e,s){j.TELEPORT_INVERSE_ACT.performWithoutChain(t,s)}}let j={DESTROY_PIECE_ACT:new S,MOVE_ACT:new W,MOVE_OR_ATTACK:new v,RANGE_ATTACK_ACT:new I,CONVERT_ACT:new k,EXPLOSION_ACT:new b,TELEPORT_INVERSE_ACT:new Y,SWAP_POSITIONS:new L,RUSH_ACT:new B,CROSS_ATTACK_ACT:new V,EXPLODE_ACT:new G,ZOMBIE_ATTACK_ACT:new X,LEGION_ATTACK_ACT:new F,TELEPORT_PIECE_ACT:new z};class Z extends T{checkUnitary(t,e){return null===t.pieceAt(e)}}class q extends P{check(t,e,s){return t.areEnemies(t.pieceAt(e),t.pieceAt(s))}}class Q extends P{check(t,e,s){let i=t.pieceAt(e),r=t.pieceAt(s);return!!i&&!!r&&!t.areEnemies(i,r)}}class J extends P{check(t,e,s){if(e.equals(s))return!1;let i=e.y-s.y,r=e.x-s.x,o=Math.max(Math.abs(i),Math.abs(r)),n=e.x,h=e.y;for(let e=1;e<o;e++)if(n-=Math.trunc(r/o),h-=Math.trunc(i/o),!t.isFree(new c.Y(n,h)))return!1;return!0}}class $ extends T{checkUnitary(t,e){let s=t.pieceAt(e);return!!s&&!s.king}}let tt=new Z,te=new q,ts=new Q,ti=new J,tr=new $,to=new m,tn={MOVE_TO_FREE_POSITION:new _(tt,j.MOVE_OR_ATTACK,"F"),MOVE_TO_ENEMY_POSITION:new _(te,j.MOVE_OR_ATTACK,"E"),MOVE_OR_ATTACK_ACTION:new _(te.OR(tt),j.MOVE_OR_ATTACK,"X"),WALK_AND_MOVE_OR_ATTACK:new _(ti.AND(te.OR(tt)),j.MOVE_OR_ATTACK,"M"),SWAP_POSITIONS_ACTION:new _(ts.AND(tt.NOT()),j.SWAP_POSITIONS,"S"),RUSH_ACTION:new _(to,j.RUSH_ACT,"R"),CROSS_ATTACK_ACTION:new _(tt,j.CROSS_ATTACK_ACT,"C"),EXPLOSION_ATTACK_ACTION:new _(tt,j.EXPLODE_ACT,"Y"),ZOMBIE_ATTACK_ACTION:new _(te,j.ZOMBIE_ATTACK_ACT,"Z"),RANGE_ATTACK_ACTION:new _(te.AND(ti),j.RANGE_ATTACK_ACT,"A"),CONVERT_ACTION:new _(te.AND(tr),j.CONVERT_ACT,"Q"),LEGION_ATTACK_ACTION:new _(te.OR(tt),j.LEGION_ATTACK_ACT,"L")};class th{setLvl(t){switch(t){case 1:this.addPositionWskAtY(2,[.12,.1,.06]),this.addPositionWskAtY(1,[.2,.2,.07]),this.addPositionWskAtY(0,[0,.2,.05]),this.CIRCLES_WSKS=[.01,.25,.64,.1],this.MIRROR2_WSK=.6,this.MIRROR4_WSK=.3,this.MIRROR8_WSK=.2;break;case 2:this.addPositionWskAtY(2,[.15,.09,.07]),this.addPositionWskAtY(1,[.15,.15,.09]),this.addPositionWskAtY(0,[0,.15,.15]),this.CIRCLES_WSKS=[0,0,.5,.4,.1],this.MIRROR2_WSK=.4,this.MIRROR4_WSK=.6,this.MIRROR8_WSK=.3;break;case 3:this.addPositionWskAtY(3,[.066,.066,.066,.066]),this.addPositionWskAtY(2,[.066,.066,.066,.066]),this.addPositionWskAtY(1,[.066,.066,.066,.066]),this.addPositionWskAtY(0,[0,.066,.066,.066]),this.CIRCLES_WSKS=[0,0,.8,.2],this.MIRROR2_WSK=.4,this.MIRROR4_WSK=.6,this.MIRROR8_WSK=.3;break;case 4:this.addPositionWskAtY(3,[.066,.066,.066,.066]),this.addPositionWskAtY(2,[.066,.066,.066,.066]),this.addPositionWskAtY(1,[.066,.066,.066,.066]),this.addPositionWskAtY(0,[0,.066,.066,.066]),this.CIRCLES_WSKS=[0,0,0,.7,.3],this.MIRROR2_WSK=.4,this.MIRROR4_WSK=.6,this.MIRROR8_WSK=.3,this.MOVE_PATTERN_NUMBER_WSKS=[.2,.4,.4],this.MOVE_PATTERN_TYPE_WSKS=[.3,.2,.2,.1,.1,.1],this.RUSH_PATTERN_NUMBER_WSKS=[.7,.2,.1],this.RUSH_PATTERN_LENGTH_WSKS=[0,0,.4,.3,.3,0];case 5:this.addPositionWskAtY(4,[.04,.04,.04,.04,.04]),this.addPositionWskAtY(3,[.04,.04,.04,.04,.04]),this.addPositionWskAtY(2,[.04,.04,.05,.04,.04]),this.addPositionWskAtY(1,[.05,.05,.04,.04,.04]),this.addPositionWskAtY(0,[0,.05,.04,.04,.04]),this.CIRCLES_WSKS=[0,0,0,0,0,.2,.6,.2],this.MIRROR2_WSK=.4,this.MIRROR4_WSK=.6,this.MIRROR8_WSK=.3,this.MOVE_PATTERN_NUMBER_WSKS=[.2,.3,.3,.2],this.MOVE_PATTERN_TYPE_WSKS=[0,0,.3,.3,.2,.2],this.RUSH_PATTERN_NUMBER_WSKS=[.5,.3,.2],this.RUSH_PATTERN_LENGTH_WSKS=[0,0,.3,.3,.2,.2];break;default:this.addPositionWskAtY(4,[.04,.04,.04,.04,.04]),this.addPositionWskAtY(3,[.04,.04,.04,.04,.04]),this.addPositionWskAtY(2,[.04,.04,.05,.04,.04]),this.addPositionWskAtY(1,[.05,.05,.04,.04,.04]),this.addPositionWskAtY(0,[0,.05,.04,.04,.04]),this.CIRCLES_WSKS=[.05,.5,.2,.1,.15],this.MIRROR2_WSK=.4,this.MIRROR4_WSK=.6,this.MIRROR8_WSK=.3}}addPositionWskAtY(t,e){for(let s=0;s<e.length;s++){let i=new c.Y(s,t);this.POSITION_WSK.set(i.key,e[s])}}getPositionWsk(t){var e;return null!==(e=this.POSITION_WSK.get(t.key))&&void 0!==e?e:0}constructor(t){this.ACTION_WSKS=new Map,this.POSITION_WSK=new Map,this.CIRCLES_WSKS=[.01,.4,.4,.1,.19],this.MIRROR2_WSK=.4,this.MIRROR4_WSK=.6,this.MIRROR8_WSK=.3,this.MOVE_PATTERN_NUMBER_WSKS=[.6,.4],this.MOVE_PATTERN_TYPE_WSKS=[.3,.2666,.2666,.169,0,0],this.MOVE_PATTERN_LENGTH_WSKS=[0,.2,.2,.2,.2,.2],this.RUSH_PATTERN_NUMBER_WSKS=[.98,.02],this.RUSH_PATTERN_TYPE_WSKS=[.8,.0666,.0666,.0669,0,0],this.RUSH_PATTERN_LENGTH_WSKS=[0,0,.5,.5,0,0],this.ACTION_WSKS.set("E",[0,0,0,0,0]),this.ACTION_WSKS.set("F",[0,0,0,0,0]),this.ACTION_WSKS.set("S",[.08,.08,.2,.06,.04]),this.ACTION_WSKS.set("X",[1,1,1,1,1]),this.ACTION_WSKS.set("L",[0,0,0,0,0]),this.ACTION_WSKS.set("C",[0,0,0,0,0]),this.ACTION_WSKS.set("Y",[0,0,0,0,0]),this.ACTION_WSKS.set("A",[0,0,0,0,0]),this.ACTION_WSKS.set("Z",[0,0,0,0,0]),this.ACTION_WSKS.set("Q",[0,0,0,0,0]),this.ACTION_WSKS.set("G",[0,0,0,0,0]),this.setLvl(t)}}(n=a||(a={})).OWN_PIECE="OWN_PIECE",n.ENEMY_PIECE="ENEMY_PIECE",n.ANY_PIECE="ANY_PIECE";class ta extends w{performChainAct(t,e,s,i){let r=t.pieceAt(s);if(!r||"ENEMY_PIECE"===this.forceType&&r.owner===t.playersTurn||"OWN_PIECE"===this.forceType&&r.owner!==t.playersTurn)return;let o=e.copy();o.setConnector(this.chainConnector),o.performWithoutChain(t,s,i)}setChainConnector(t){this.chainConnector=t}constructor(t="ANY_PIECE"){super(),this.chainConnector=null,this.forceType=t}}class tc extends ta{performWithoutChain(t,e){if(!t.isOnboard(e)||t.isFree(e))return;let s=t.pieceAt(e);if(!s)return;t.computePossibleMovesForPiece(s);let i=this.getRandomMove(t,s);if(!i)return;let r=s.owner===d.W.TOPDOWN_PLAYER,o=i.minus(e);r&&(o=o.invertY());let n=s.pieceType.actionMap.get(o);n&&this.performChainAct(t,n.act,e,i)}getRandomMove(t,e){let s=e.moveSet.getPossibleMoves();if(0===s.length)return null;let i=Math.floor(new u.R(e.pos.x*e.pos.y+t.getAllPieces().length).next()*s.length);return s[i]}constructor(t=a.ANY_PIECE){super(t)}}class tu extends ta{performWithoutChain(t,e){if(!t.isOnboard(e)||t.isFree(e))return;let s=t.pieceAt(e);if(!s)return;t.computePossibleMovesForPiece(s);let i=this.getRandomMovePrefAttack(t,s);if(!i||!s.isPossibleMove(i))return;let r=s.owner===d.W.TOPDOWN_PLAYER,o=i.minus(e);r&&(o=o.invertY());let n=s.pieceType.actionMap.get(o);n&&this.performChainAct(t,n.act,e,i)}getRandomMovePrefAttack(t,e){let s=new u.R(e.pos.x*e.pos.y+t.getAllPieces().length),i=e.moveSet.getPossibleMoves();if(0===i.length)return null;let r=[];for(let s of i){if(t.isFree(s))continue;let i=t.pieceAt(s);i&&t.areEnemies(e,i)&&r.push(s)}return r.length>0?r[Math.floor(s.next()*r.length)]:i[Math.floor(s.next()*i.length)]}constructor(t=a.ANY_PIECE){super(t)}}class tl extends ta{performWithoutChain(t,e){t.isOnboard(e)&&t.isFree(e)||(this.performChainAct(t,j.RANGE_ATTACK_ACT.copy(),e,e.add(-2,0)),this.performChainAct(t,j.RANGE_ATTACK_ACT.copy(),e,e.add(0,-2)),this.performChainAct(t,j.RANGE_ATTACK_ACT.copy(),e,e.add(2,0)),this.performChainAct(t,j.RANGE_ATTACK_ACT.copy(),e,e.add(0,2)))}constructor(t=a.ANY_PIECE){super(t)}}class td{generate(t){let e=this.getRandomInitialAction();return this.generateNextStep(e.act,t),e.symbol="".concat(t),e}generateNextStep(t,e){if(0===e)return;let s=this.getRandomPosSet(t),i=this.generateUnitaryAct(t,s);if(t instanceof ta&&.5>this.random.next()){let r=new y;r.addChain(s,i),t.setChainConnector(r),this.generateNextStep(i,e-1);return}t.createConnector().addChain(s,i),this.generateNextStep(i,e-1)}getRandomPosSet(t){return t instanceof R?this.getRandomBinaryPosSet():this.getRandomUnitaryPosSet()}getRandomUnitaryPosSet(){let t=[[h.pos,.5],[h.posAround,.5]],e=this.random.next();for(let[s,i]of t)if((e-=i)<=0)return s;return h.pos}getRandomBinaryPosSet(){let t=[[h.toPos,.5],[h.toPosAround,.3],[h.fromPos,.1],[h.fromPosAround,.1]],e=this.random.next();for(let[s,i]of t)if((e-=i)<=0)return s;return h.toPos}generateUnitaryAct(t,e){if(t instanceof S&&e===h.pos)return this.generateFreePosAct();if(t instanceof I){if(e===h.toPos)return this.generateFreePosAct();if(e===h.fromPos)return this.generateOwnPosAct()}if(t instanceof v){if(e===h.toPos)return this.generateOwnPosAct();if(e===h.fromPos)return this.generateFreePosAct()}let s=[[j.EXPLOSION_ACT.copy(),1],[j.DESTROY_PIECE_ACT.copy(),.4],[new tc(a.ENEMY_PIECE),.6],[new tl(a.OWN_PIECE),.5],[new tu(a.OWN_PIECE),.5]],i=3*this.random.next();for(let[t,e]of s)if((i-=e)<=0)return t;return j.EXPLOSION_ACT.copy()}generateFreePosAct(){return j.EXPLOSION_ACT.copy()}generateOwnPosAct(){let t=[[new tl(a.OWN_PIECE),.5],[new tu(a.OWN_PIECE),.5]],e=this.random.next();for(let[s,i]of t)if((e-=i)<=0)return s;return t[0][0]}getRandomInitialAction(){let t=[[tn.MOVE_OR_ATTACK_ACTION.copy(),.5],[tn.RANGE_ATTACK_ACTION.copy(),.5]],e=this.random.next();for(let[s,i]of t)if((e-=i)<=0)return s;return t[0][0]}constructor(t){this.random=new u.R(t)}}let tp=[{name:"up",dPos:[new c.Y(0,-1)]},{name:"updown",dPos:[new c.Y(0,-1),new c.Y(0,-1)]},{name:"v",dPos:[new c.Y(-1,-1),new c.Y(1,-1)]},{name:"leftRight",dPos:[new c.Y(0,-1),new c.Y(0,-1)]},{name:"cross",dPos:[new c.Y(-1,-1),new c.Y(1,-1),new c.Y(1,1),new c.Y(-1,1)]},{name:"plus",dPos:[new c.Y(0,-1),new c.Y(1,0),new c.Y(0,1),new c.Y(-1,0)]}];class tP{generate(t,e){this.rand=new u.R(e),this.gc=new th(t),this.lvl=t;let s=this.generateActions(),i=d.W.getInstance(t,e,"V1");return i.actionMap=s,i}generateActions(){let t=new p.C;return this.generateJumpActions(t),this.generateWalkActions(t),this.generateRushActions(t),t}diceWsks(t){return function(t,e){let s=e.next();for(let e=0;e<t.length;e++){if(s<=t[e])return e;s-=t[e]}return t.length-1}(t,this.rand)}dicePosition(){let t=Array.from(this.gc.POSITION_WSK.keys()).sort((t,e)=>{let s=c.Y.fromKey(t),i=c.Y.fromKey(e);return s.compareTo(i)}),e=this.rand.next();for(let s of t){let t=this.gc.POSITION_WSK.get(s);if(e<=t)return c.Y.fromKey(s);e-=t}return new c.Y(0,0)}generateJumpActions(t){let e=this.diceWsks(this.gc.CIRCLES_WSKS);for(let s=0;s<e;s++){let e=this.dicePosition(),i=e.x,r=e.y,o=this.generateActionType();if(0===i&&0===r)s--;else{let e=1>=Math.max(Math.abs(i),Math.abs(r))&&("X"===o.symbol||"R"===o.symbol)?tn.WALK_AND_MOVE_OR_ATTACK:o,s=this.rand.next();s<=this.gc.MIRROR2_WSK?this.addToMap(t,this.getMirrors2(new c.Y(i,r)),e):s-this.gc.MIRROR2_WSK<=this.gc.MIRROR4_WSK?this.addToMap(t,this.getMirrors4(new c.Y(i,r)),e):this.addToMap(t,this.getMirrors8(new c.Y(i,r)),e)}}}generateActionType(){let t=this.rand.next();for(let s of["E","F","L","S","C","Y","A","Z","Q","G"]){var e;let i=this.gc.ACTION_WSKS.get(s);if(!i)continue;let r=null!==(e=i[this.lvl-1])&&void 0!==e?e:0;if(t<r){if("G"===s)return new td(this.rand.nextLong()).generate(5);return this.getActionBySymbol(s)}t-=r}return tn.MOVE_OR_ATTACK_ACTION}getActionBySymbol(t){var e;return null!==(e=({E:tn.MOVE_TO_ENEMY_POSITION,F:tn.MOVE_TO_FREE_POSITION,X:tn.MOVE_OR_ATTACK_ACTION,M:tn.WALK_AND_MOVE_OR_ATTACK,S:tn.SWAP_POSITIONS_ACTION,R:tn.RUSH_ACTION,C:tn.CROSS_ATTACK_ACTION,Y:tn.EXPLOSION_ATTACK_ACTION,Z:tn.ZOMBIE_ATTACK_ACTION,A:tn.RANGE_ATTACK_ACTION,Q:tn.CONVERT_ACTION,L:tn.LEGION_ATTACK_ACTION})[t])&&void 0!==e?e:tn.MOVE_OR_ATTACK_ACTION}addToMap(t,e,s){for(let i of e)t.put(i,s)}getMirrors8(t){let e=t.x,s=t.y,i=new Set,r=[];for(let t of[new c.Y(e,s),new c.Y(-e,s),new c.Y(e,-s),new c.Y(-e,-s),new c.Y(s,e),new c.Y(s,-e),new c.Y(-s,e),new c.Y(-s,-e)])i.has(t.key)||(i.add(t.key),r.push(t));return r}getMirrors4(t){let e=t.x,s=t.y,i=new Set,r=[];for(let t of[new c.Y(e,s),new c.Y(-e,s),new c.Y(e,-s),new c.Y(-e,-s)])i.has(t.key)||(i.add(t.key),r.push(t));return r}getMirrors2(t){let e=t.x,s=t.y,i=new Set,r=[];for(let t of[new c.Y(e,s),new c.Y(-e,s)])i.has(t.key)||(i.add(t.key),r.push(t));return r}generateWalkActions(t){let e=this.diceWsks(this.gc.MOVE_PATTERN_NUMBER_WSKS);for(let s=0;s<e;s++){let e=tp[this.diceWsks(this.gc.MOVE_PATTERN_TYPE_WSKS)],s=this.diceWsks(this.gc.MOVE_PATTERN_LENGTH_WSKS);this.createLineActions(t,e,s,tn.WALK_AND_MOVE_OR_ATTACK)}}generateRushActions(t){let e=this.diceWsks(this.gc.RUSH_PATTERN_NUMBER_WSKS);for(let s=0;s<e;s++){let e=tp[this.diceWsks(this.gc.RUSH_PATTERN_TYPE_WSKS)],s=this.diceWsks(this.gc.RUSH_PATTERN_LENGTH_WSKS);this.createLineActions(t,e,s,tn.RUSH_ACTION)}}createLineActions(t,e,s,i){if(!(s<1)&&!(s>8))for(let r of e.dPos)this.createDiagonal(t,r.add(r.x*s,-r.y*s),i)}createDiagonal(t,e,s){let i=e.x,r=e.y;if(Math.abs(i)!==Math.abs(r)&&0===i&&0===r)return;let o=new c.Y(0,0),n=Math.max(Math.abs(i),Math.abs(r));for(let e=0;e<n;e++){let e=0!==i?i/Math.abs(i):0,n=0!==r?r/Math.abs(r):0,h=Math.max(Math.abs((o=o.add(e,n)).x),Math.abs(o.y)),a="R"===s.symbol&&h<=1?tn.WALK_AND_MOVE_OR_ATTACK:s;t.put(o,a)}}}class tT{generate(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],new tP().generate(t,e)}}class tA{generate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=new l(5,this.rand.nextLong());for(let s=1;s<=5;s++)for(let i=0;i<t;i++)e.get(s).push(this.generatePiece(s,this.rand.nextLong()));return e}generatePiece(t,e){let s=this.gen.generate(t,e,"V1");return s.symbol=String.fromCharCode(this.symbolCounter),this.symbolCounter++,s}constructor(t){this.gen=new tT,this.symbolCounter=100,this.rand=new u.R(t)}}class tf{static poolSizeFor(t){return t.width>=500?25:t.width>=100?15:t.width>=50?10:5}generate(){var t;let e=this.pieceTypePool.getRandomPieceType(1),s=(t=this.size,new c.Y(Math.floor(t.width/2),0));return this.formationBuilder.putKing(e,s),this.putPieces(),this.formationBuilder.build()}putPieces(){"gigantic"===this.size.name?(this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(1500,95)),this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(1200,85)),this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(1e3,75)),this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(800,65)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(1e3,58)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(800,50)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(600,42)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(700,35)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(500,28)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(400,22)),this.addPiecesToBoard(this.pieceTypePool.get(4),this.randomPositions(400,16)),this.addPiecesToBoard(this.pieceTypePool.get(4),this.randomPositions(300,11)),this.addPiecesToBoard(this.pieceTypePool.get(5),this.randomPositions(200,7)),this.addPiecesToBoard(this.pieceTypePool.get(5),this.randomPositions(150,3))):"massive"===this.size.name?(this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(300,23)),this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(250,20)),this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(200,17)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(200,15)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(180,13)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(150,11)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(120,9)),this.addPiecesToBoard(this.pieceTypePool.get(4),this.randomPositions(100,7)),this.addPiecesToBoard(this.pieceTypePool.get(4),this.randomPositions(80,5)),this.addPiecesToBoard(this.pieceTypePool.get(5),this.randomPositions(60,3)),this.addPiecesToBoard(this.pieceTypePool.get(5),this.randomPositions(40,1))):"huge"===this.size.name?(this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(100,14)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(80,12)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(60,9)),this.addPiecesToBoard(this.pieceTypePool.get(4),this.randomPositions(40,6)),this.addPiecesToBoard(this.pieceTypePool.get(5),this.randomPositions(20,3))):"big"===this.size.name?(this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(27,10)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(22,9)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(14,7)),this.addPiecesToBoard(this.pieceTypePool.get(4),this.randomPositions(8,5)),this.addPiecesToBoard(this.pieceTypePool.get(5),this.randomPositions(4,3))):"medium"===this.size.name?(this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(14,6)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(17,5)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(8,4)),this.addPiecesToBoard(this.pieceTypePool.get(4),this.randomPositions(4,2))):"small"===this.size.name?(this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(8,3)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(10,2)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(4,1))):(this.addPiecesToBoard(this.pieceTypePool.get(1),this.randomPositions(4,3)),this.addPiecesToBoard(this.pieceTypePool.get(2),this.randomPositions(4,2)),this.addPiecesToBoard(this.pieceTypePool.get(3),this.randomPositions(5,1)))}randomPositions(t,e){return e>=Math.floor(this.size.height/2)||t<=0?[]:function(t,e,s,i,r,o){let n=[];for(let t=0;t<=e;t++)for(let e=s;e<=i;e++)n.push(new c.Y(t,e));let h=Math.min(r,n.length),a=[];for(let t=0;t<h;t++){let t=Math.floor(o.next()*n.length);a.push(n[t]),n.splice(t,1)}return a}(0,this.size.width-1,e,e+1,t,this.rand)}addPiecesToBoard(t,e){for(let s of e){let e=function(t,e){let s=e.nextInt(t.length);return t[s]}(t,this.rand);this.formationBuilder.putPiece(e,s)}}constructor(t,e){this.rand=new u.R(t),this.size=e;let s=tf.poolSizeFor(e);this.pieceTypePool=new tA(this.rand.nextLong()).generate(s),this.formationBuilder=new r(e)}}},6880:function(t,e,s){s.d(e,{R:function(){return i}});class i{next(){this.state=this.state+1831565813|0;let t=Math.imul(this.state^this.state>>>15,1|this.state);return(((t=t+Math.imul(t^t>>>7,61|t)^t)^t>>>14)>>>0)/4294967296}nextInt(t){return Math.floor(this.next()*t)}nextLong(){return 4294967296*(4294967296*this.next()|0)+((4294967296*this.next()|0)>>>0)}nextDouble(){return this.next()}constructor(t){this.state=0|t}}},5953:function(t,e,s){s.d(e,{C:function(){return r}});var i=s(406);class r{put(t,e){this.actions.set(t.key,e)}get(t){var e;return null!==(e=this.actions.get(t.key))&&void 0!==e?e:null}keySet(){return Array.from(this.actions.keys()).map(i.Y.fromKey)}getActionSet(){return new Set(this.actions.values())}getByXY(t,e){var s;return null!==(s=this.actions.get("".concat(t,",").concat(e)))&&void 0!==s?s:null}getAll(){return this.actions}size(){return this.actions.size}print(){let t="";for(let[e,s]of this.actions){let r=i.Y.fromKey(e);t+=" ".concat(s.symbol).concat(r.toString())}return t}constructor(){this.actions=new Map}}},4552:function(t,e,s){s.d(e,{f:function(){return i}});class i{getPossibleMoves(){return this.possibleMoves}size(){return this.possibleMoves.length}getPos(t){return this.possibleMoves[t]}getTag(t){return this.possibleMoves[t].tag}add(t){this.possibleMoves.push(t)}constructor(t){this.possibleMoves=[],t&&(this.possibleMoves=t)}}},4892:function(t,e,s){s.d(e,{W:function(){return c}});var i=s(3418),r=s(406);class o extends r.Y{static fromPos(t,e){return new o(t.x,t.y,e)}copy(){return new o(this.x,this.y,this.tag)}constructor(t,e,s){super(t,e),this.tag=s}}var n=s(5953),h=s(4552);class a{constructor(t,e,s){this.seed=t,this.lvl=e,this.generatorVersion=s}}class c{static getInstance(t,e,s){return new c(t,e,s)}perform(t,e,s){let i=t.pieceAt(e);if(!i)return null;let r=i.owner===c.TOPDOWN_PLAYER,o=s.minus(e);r&&(o.y=-o.y);let n=this.actionMap.get(o);return n?(n.perform(t,e,s),n):null}performWithoutChain(t,e,s){let i=t.pieceAt(e);if(!i)return null;let r=i.owner===c.TOPDOWN_PLAYER,o=s.minus(e);r&&(o.y=-o.y);let n=this.actionMap.get(o);return n?(n.performWithoutChain(t,e,s),n):null}computePossibleMoves(t,e){let s=t.pieceAt(e);if(!s)return new h.f;let i=s.owner===c.TOPDOWN_PLAYER,n=[];for(let s of this.actionMap.keySet()){let h=s.x,a=s.y;i&&(a=-a);let c=this.actionMap.get(s);if(!c)continue;let u=new r.Y(e.x+h,e.y+a);t.isOnboard(u)&&c.checkCondition(t,e,u)&&n.push(o.fromPos(u,c.symbol))}return new h.f(n)}isPossibleMove(t,e,s){let i=t.pieceAt(e);if(!i)return!1;let r=i.owner===c.TOPDOWN_PLAYER?s.minus(e).invertY():s.minus(e),o=this.actionMap.get(r);return!!o&&t.isOnboard(s)&&o.checkCondition(t,e,s)}constructor(t,e,s){this.symbol="X",this.actionMap=new n.C,this.pieceTypeId=new a(e,t,s)}}c.TOPDOWN_PLAYER=i.GG.P1}}]);